import { Injectable } from '@angular/core';
import { BehaviorSubject, combineLatest, of, Subject } from 'rxjs';
import { distinctUntilChanged, map, switchMap, take } from 'rxjs/operators';
import { untilDestroy } from '../../shared/operators/untilDestroy';
import { EResultPreviewType, } from '../models';
import { ALERTS, DEFAULT_REPORT_CONFIG } from '../utils/constants';
import { truthy } from '../utils/operators';
import * as helpers from '../utils/statistics';
import * as i0 from "@angular/core";
import * as i1 from "./copyleaks.service";
/**
 * @todo implement saving options localstorage
 */
export class ReportService {
    constructor(copyleaksService) {
        this.copyleaksService = copyleaksService;
        // * scans API items
        this._completeResult = new BehaviorSubject(null);
        this._source = new BehaviorSubject(null);
        this._previews = new BehaviorSubject(null);
        this._results = new BehaviorSubject([]);
        // * optional total result
        this._totalResults = new BehaviorSubject(null);
        // * configurable state
        this._config = new BehaviorSubject({ ...DEFAULT_REPORT_CONFIG });
        this._progress = new BehaviorSubject(null);
        this._hiddenResults = new BehaviorSubject([]);
        // * Event emitters
        this._helpClick = new Subject();
        this._shareClick = new Subject();
        this._downloadClick = new Subject();
        this._planUpgradeEvent = new Subject();
        this._configChange = new Subject();
        this.completeResult$ = this._completeResult.asObservable().pipe(truthy());
        this.totalResults$ = this._totalResults.asObservable();
        this.source$ = this._source.asObservable().pipe(truthy(), take(1));
        this.progress$ = this._progress.asObservable();
        /** config observable */
        this.config$ = this._config.asObservable();
        /** sub config observeables */
        this.contentMode$ = this.config$.pipe(map(x => x.contentMode));
        this.viewMode$ = this.config$.pipe(map(x => x.viewMode));
        this.viewMode = this._config.value.viewMode;
        this.suspectId$ = this.config$.pipe(map(x => x.suspectId));
        this.help$ = this.config$.pipe(map(x => x.help));
        this.download$ = this.config$.pipe(map(x => x.download));
        this.settings$ = this.config$.pipe(map(x => x.settings));
        this.share$ = this.config$.pipe(map(x => x.share));
        this.options$ = this.config$.pipe(map(x => x.options));
        this.resultCardActions$ = this.config$.pipe(map(x => x.resultCardActions));
        this.onlyOneToOne$ = this.config$.pipe(map(x => x.disableSuspectBackButton));
        this.sourcePage$ = this.config$.pipe(map(x => x.sourcePage));
        this.suspectPage$ = this.config$.pipe(map(x => x.suspectPage));
        this.suspectResult$ = this.suspectId$.pipe(switchMap(id => (id ? this.findResultById$(id) : of(null))));
        this.suspectPreview$ = this.suspectId$.pipe(switchMap(id => (id ? this.findPreviewById$(id) : of(null))));
        this.hiddenResults$ = this._hiddenResults.asObservable().pipe(distinctUntilChanged());
        this.results$ = this._results.asObservable().pipe(truthy());
        this.previews$ = this._previews.asObservable().pipe(truthy());
        this.filteredPreviews$ = combineLatest([this.previews$, this.hiddenResults$]).pipe(map(([results, ids]) => results.filter(result => !ids.includes(result.id))));
        this.filteredResults$ = combineLatest([this.results$, this.hiddenResults$]).pipe(map(([results, ids]) => results.filter(result => !ids.includes(result.id))));
        this.helpClick$ = this._helpClick.asObservable();
        this.downloadClick$ = this._downloadClick.asObservable();
        this.planUpgradeEvent$ = this._planUpgradeEvent.asObservable();
        this.shareClick$ = this._shareClick.asObservable();
        this.configChange$ = this._configChange.asObservable();
        const { onCompleteResult$, onResultPreview$, onProgress$, onResultItems$, onScanSource$, onReportConfig$, filteredResultsIds$, onTotalResultsChange$, onDeleteResultById$, onDeleteProccessFinish$, } = copyleaksService;
        onCompleteResult$.pipe(untilDestroy(this)).subscribe(completeResult => this.setCompleteResult(completeResult));
        onResultPreview$.pipe(untilDestroy(this)).subscribe(preview => this.addPreview(preview));
        onProgress$.pipe(untilDestroy(this)).subscribe(progress => this.setProgress(progress));
        onTotalResultsChange$.pipe(untilDestroy(this)).subscribe(totalResults => this.setTotalResults(totalResults));
        onResultItems$.pipe(untilDestroy(this)).subscribe(resultItem => this.addDownloadedResults(resultItem));
        onScanSource$.pipe(untilDestroy(this)).subscribe(source => this.setSource(source));
        onReportConfig$.pipe(untilDestroy(this)).subscribe(config => this.configure(config));
        this.config$.pipe(untilDestroy(this)).subscribe(config => this._configChange.next(config));
        combineLatest([this.source$, this.completeResult$])
            .pipe(untilDestroy(this), take(1))
            .subscribe(() => this._progress.next(100));
        filteredResultsIds$
            .pipe(untilDestroy(this), distinctUntilChanged())
            .subscribe(ids => this._hiddenResults.next(ids));
        onDeleteResultById$.pipe(untilDestroy(this)).subscribe(id => {
            const currentCompleteResult = this._completeResult.value;
            const statistics = helpers.calculateStatistics(currentCompleteResult, this._results.value.filter(r => r.id !== id), {
                showIdentical: true,
                showMinorChanges: true,
                showPageSources: true,
                showOnlyTopResults: false,
                showRelated: true,
            });
            this.setCompleteResult({
                ...currentCompleteResult,
                scannedDocument: {
                    ...currentCompleteResult.scannedDocument,
                    totalWords: statistics.total,
                    totalExcluded: statistics.omittedWords,
                },
                results: {
                    ...currentCompleteResult.results,
                    batch: currentCompleteResult.results.batch.filter(r => r.id !== id),
                    internet: currentCompleteResult.results.internet.filter(r => r.id !== id),
                    database: currentCompleteResult.results.database.filter(r => r.id !== id),
                    repositories: currentCompleteResult.results.repositories?.filter(r => r.id !== id),
                    score: {
                        ...currentCompleteResult.results.score,
                        aggregatedScore: statistics.aggregatedScore,
                        identicalWords: statistics.identical,
                        relatedMeaningWords: statistics.relatedMeaning,
                        minorChangedWords: statistics.minorChanges,
                    },
                },
            });
            this._results.next(this._results.value.filter(r => r.id !== id));
            onDeleteProccessFinish$.next(this._completeResult.value);
        });
    }
    /**
     * Get an observable of some result by id
     * The observable completes after emitting the result
     * @param id the result id
     */
    findResultById$(id) {
        return this.results$.pipe(map(results => results.find(res => res.id === id)), truthy(), take(1));
    }
    /**
     * Get an observable of some preview by id
     * The observable completes after emitting the result
     * @param id the preview id
     */
    findPreviewById$(id) {
        return this._previews.pipe(truthy(), map(preview => preview.find(res => res.id === id)), take(1));
    }
    /**
     * Pushes a new complete result that contains the report `metadata` and updates the metadata observer.
     * @param completeResult the complete result object
     */
    setCompleteResult(completeResult) {
        const { internet, database, batch, repositories } = completeResult.results;
        const previews = [
            ...(repositories && repositories.length
                ? repositories.map(r => ({ ...r, type: EResultPreviewType.Repositroy }))
                : []),
            ...internet.map(r => ({ ...r, type: EResultPreviewType.Internet })),
            ...database.map(r => ({ ...r, type: EResultPreviewType.Database })),
            ...batch.map(r => ({ ...r, type: EResultPreviewType.Batch })),
        ];
        previews.sort((a, b) => a.matchedWords - b.matchedWords).forEach(preview => this.addPreview(preview));
        this._previews.next(previews);
        if (!completeResult.scannedDocument.creationTime.endsWith('Z')) {
            completeResult.scannedDocument.creationTime += 'Z';
        }
        if (completeResult.filters && completeResult.filters.resultIds) {
            this.setHiddenResults(completeResult.filters.resultIds);
        }
        this._completeResult.next(completeResult);
    }
    /**
     * set the total results observer
     * @param totalResults the total results amount
     */
    setTotalResults(totalResults) {
        this._totalResults.next(totalResults);
    }
    /**
     * Pushes a new scan `source` to the source observer
     * @param source the scanned document source
     */
    setSource(source) {
        this._source.next(source);
        /** Switch to text in case no html exists */
        if (source && (!source.html || !source.html.value) && this._config.value.contentMode === 'html') {
            this.configure({ contentMode: 'text' });
        }
    }
    /**
     * Pushes a new number to the `progress` observer
     * Should be a positive integer between 0 and 100;
     * if `progress` is equal to 100 then the progress observer will complete.
     * (This behaviour might change in the future)
     * @param progress the progress to display
     */
    setProgress(progress) {
        this._progress.next(progress);
    }
    /**
     * Pushes a new list of `ids` to the hidden results observer
     * @param ids the ids to hide
     */
    setHiddenResults(ids) {
        const currentCompleteResult = this._completeResult?.value;
        let aggregatedScore = null;
        if (currentCompleteResult) {
            const statistics = helpers.calculateStatistics(currentCompleteResult, this._results.value.filter(r => !ids.includes(r.id)), {
                showIdentical: true,
                showMinorChanges: true,
                showPageSources: true,
                showOnlyTopResults: false,
                showRelated: true,
            });
            aggregatedScore = statistics.aggregatedScore;
        }
        this.copyleaksService.setFilteredResultsIds(ids, aggregatedScore);
    }
    /**
     * Pushes a new `event` to the help-click observer, indicating the help button was clicked
     * @param event native click event
     */
    helpBtnClicked(event) {
        this._helpClick.next(event);
    }
    /**
     * Pushes a new `event` to the share-click observer, indicating the share button was clicked
     * @param event native click event
     */
    shareBtnClicked(event) {
        this._shareClick.next(event);
    }
    /**
     * Pushes a new `event` to the download-click observer, indicating the download button was clicked
     * @param event native click event
     */
    downloadBtnClicked(event) {
        this._downloadClick.next(event);
    }
    /**
     * Pushes a new `event` to the plan-upgrade event observer, indicating the plan-upgrade event button was clicked
     */
    upgradePlanEvent() {
        const completeResult = this._completeResult?.value;
        let recommendedPagesAmount = completeResult.scannedDocument?.credits;
        if (completeResult?.scannedDocument?.expectedCredits) {
            recommendedPagesAmount =
                completeResult?.scannedDocument?.expectedCredits - completeResult.scannedDocument?.credits;
        }
        this._planUpgradeEvent.next(recommendedPagesAmount);
    }
    /**
     * Push a new `preview` of a result to the previews observer
     * This function does nothing if the complete result is ready
     * or if the preview was allready pushed
     * @param preview the preview to push next
     */
    addPreview(preview) {
        if (!this._completeResult.value && !(this._previews.value || []).find(p => p.id === preview.id)) {
            this._previews.next([...(this._previews.value || []), preview]);
        }
    }
    /**
     * Pushes an array of new `result`s to the results observable
     * @param resultItems an array containing resultItem elements
     */
    addDownloadedResults(resultItems) {
        const newItems = resultItems.filter(res => !this._results.value.find(x => x.id === res.id));
        if (newItems.length) {
            this._results.next([...this._results.value, ...newItems]);
        }
    }
    /**
     * Edit the current state of the report using either a full or partial configuration object
     * @param config the configuration object
     */
    configure(config) {
        this._config.next(Object.assign(this._config.value, config));
    }
    hasNonAIAlerts() {
        const completeResult = this._completeResult.value;
        if (completeResult?.notifications?.alerts?.filter(s => s.code != ALERTS.SUSPECTED_AI_TEXT_DETECTED).length > 0) {
            return true;
        }
        return false;
    }
    isPlagiarismEnabled() {
        const completeResult = this._completeResult.value;
        if (completeResult) {
            if (completeResult?.scannedDocument?.enabled?.plagiarismDetection != null)
                return completeResult?.scannedDocument?.enabled?.plagiarismDetection;
        }
        return true;
    }
    isAiDetectionEnabled() {
        const completeResult = this._completeResult.value;
        if (completeResult) {
            if (completeResult?.scannedDocument?.enabled?.aiDetection)
                return true;
            return (completeResult?.notifications?.alerts?.length &&
                completeResult?.notifications?.alerts.filter(alert => alert.code == ALERTS.SUSPECTED_AI_TEXT_DETECTED).length ==
                    1);
        }
        return false;
    }
    getAiScore() {
        if (this.isAiDetectionEnabled()) {
            const completeResult = this._completeResult.value;
            const aiAlert = completeResult.notifications.alerts.find(alert => alert.code == ALERTS.SUSPECTED_AI_TEXT_DETECTED);
            if (aiAlert) {
                const aiData = JSON.parse(aiAlert.additionalData);
                return aiData.summary.ai;
            }
            return 0;
        }
        return null;
    }
    /** Completes all subjects to prevent memory leak */
    cleanup() {
        this._config.complete();
        this._completeResult.complete();
        this._source.complete();
        this._previews.complete();
        this._results.complete();
        this._progress.complete();
        this._totalResults.complete();
        this._hiddenResults.complete();
        this._downloadClick.complete();
        this._shareClick.complete();
        this._configChange.complete();
    }
    /** Clean all subjects and notify that the report has been destroyed */
    ngOnDestroy() {
        this.cleanup();
        this.copyleaksService.notifyDestroy();
    }
}
ReportService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.3", ngImport: i0, type: ReportService, deps: [{ token: i1.CopyleaksService }], target: i0.ɵɵFactoryTarget.Injectable });
ReportService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.3.3", ngImport: i0, type: ReportService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.3", ngImport: i0, type: ReportService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.CopyleaksService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3J0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9wbGFnaWFyaXNtLXJlcG9ydC9zcmMvbGliL3BsYWdpYXJpc20tcmVwb3J0L3NlcnZpY2VzL3JlcG9ydC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDdEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQWMsRUFBRSxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDbkUsT0FBTyxFQU1OLGtCQUFrQixHQUNsQixNQUFNLFdBQVcsQ0FBQztBQUNuQixPQUFPLEVBQUUsTUFBTSxFQUFFLHFCQUFxQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDbkUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRTVDLE9BQU8sS0FBSyxPQUFPLE1BQU0scUJBQXFCLENBQUM7OztBQUcvQzs7R0FFRztBQUVILE1BQU0sT0FBTyxhQUFhO0lBc0J6QixZQUFvQixnQkFBa0M7UUFBbEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQXJCdEQsb0JBQW9CO1FBQ1osb0JBQWUsR0FBRyxJQUFJLGVBQWUsQ0FBaUIsSUFBSSxDQUFDLENBQUM7UUFDNUQsWUFBTyxHQUFHLElBQUksZUFBZSxDQUFhLElBQUksQ0FBQyxDQUFDO1FBQ2hELGNBQVMsR0FBRyxJQUFJLGVBQWUsQ0FBa0IsSUFBSSxDQUFDLENBQUM7UUFDdkQsYUFBUSxHQUFHLElBQUksZUFBZSxDQUFlLEVBQUUsQ0FBQyxDQUFDO1FBRXpELDBCQUEwQjtR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QXVFO0lBQ3ZFLFdBQVc7UUFDVixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDZixJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkMsQ0FBQzs7MEdBbllXLGFBQWE7OEdBQWIsYUFBYTsyRkFBYixhQUFhO2tCQUR6QixVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIGNvbWJpbmVMYXRlc3QsIE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgbWFwLCBzd2l0Y2hNYXAsIHRha2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyB1bnRpbERlc3Ryb3kgfSBmcm9tICcuLi8uLi9zaGFyZWQvb3BlcmF0b3JzL3VudGlsRGVzdHJveSc7XG5pbXBvcnQge1xuXHRDb21wbGV0ZVJlc3VsdCxcblx0Q29weWxlYWtzUmVwb3J0Q29uZmlnLFxuXHRSZXN1bHRJdGVtLFxuXHRSZXN1bHRQcmV2aWV3LFxuXHRTY2FuU291cmNlLFxuXHRFUmVzdWx0UHJldmlld1R5cGUsXG59IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBBTEVSVFMsIERFRkFVTFRfUkVQT1JUX0NPTkZJRyB9IGZyb20gJy4uL3V0aWxzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyB0cnV0aHkgfSBmcm9tICcuLi91dGlscy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQ29weWxlYWtzU2VydmljZSB9IGZyb20gJy4vY29weWxlYWtzLnNlcnZpY2UnO1xuaW1wb3J0ICogYXMgaGVscGVycyBmcm9tICcuLi91dGlscy9zdGF0aXN0aWNzJztcbmltcG9ydCB7IEFJU2NhblJlc3VsdCB9IGZyb20gJy4uL21vZGVscy9BSU1hdGNoJztcblxuLyoqXG4gKiBAdG9kbyBpbXBsZW1lbnQgc2F2aW5nIG9wdGlvbnMgbG9jYWxzdG9yYWdlXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSZXBvcnRTZXJ2aWNlIGltcGxlbWVudHMgT25EZXN0cm95IHtcblx0Ly8gKiBzY2FucyBBUEkgaXRlbXNcblx0cHJpdmF0ZSBfY29tcGxldGVSZXN1bHQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PENvbXBsZXRlUmVzdWx0PihudWxsKTtcblx0cHJpdmF0ZSBfc291cmNlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxTY2FuU291cmNlPihudWxsKTtcblx0cHJpdmF0ZSBfcHJldmlld3MgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFJlc3VsdFByZXZpZXdbXT4obnVsbCk7XG5cdHByaXZhdGUgX3Jlc3VsdHMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFJlc3VsdEl0ZW1bXT4oW10pO1xuXG5cdC8vICogb3B0aW9uYWwgdG90YWwgcmVzdWx0XG5cdHByaXZhdGUgX3RvdGFsUmVzdWx0cyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8bnVtYmVyPihudWxsKTtcblxuXHQvLyAqIGNvbmZpZ3VyYWJsZSBzdGF0ZVxuXHRwcml2YXRlIF9jb25maWcgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PENvcHlsZWFrc1JlcG9ydENvbmZpZz4oeyAuLi5ERUZBVUxUX1JFUE9SVF9DT05GSUcgfSk7XG5cdHByaXZhdGUgX3Byb2dyZXNzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxudW1iZXI+KG51bGwpO1xuXHRwcml2YXRlIF9oaWRkZW5SZXN1bHRzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmdbXT4oW10pO1xuXG5cdC8vICogRXZlbnQgZW1pdHRlcnNcblx0cHJpdmF0ZSBfaGVscENsaWNrID0gbmV3IFN1YmplY3Q8TW91c2VFdmVudD4oKTtcblx0cHJpdmF0ZSBfc2hhcmVDbGljayA9IG5ldyBTdWJqZWN0PE1vdXNlRXZlbnQ+KCk7XG5cdHByaXZhdGUgX2Rvd25sb2FkQ2xpY2sgPSBuZXcgU3ViamVjdDxNb3VzZUV2ZW50PigpO1xuXHRwcml2YXRlIF9wbGFuVXBncmFkZUV2ZW50ID0gbmV3IFN1YmplY3Q8bnVtYmVyPigpO1xuXHRwcml2YXRlIF9jb25maWdDaGFuZ2UgPSBuZXcgU3ViamVjdDxDb3B5bGVha3NSZXBvcnRDb25maWc+KCk7XG5cblx0Y29uc3RydWN0b3IocHJpdmF0ZSBjb3B5bGVha3NTZXJ2aWNlOiBDb3B5bGVha3NTZXJ2aWNlKSB7XG5cdFx0Y29uc3Qge1xuXHRcdFx0b25Db21wbGV0ZVJlc3VsdCQsXG5cdFx0XHRvblJlc3VsdFByZXZpZXckLFxuXHRcdFx0b25Qcm9ncmVzcyQsXG5cdFx0XHRvblJlc3VsdEl0ZW1zJCxcblx0XHRcdG9uU2NhblNvdXJjZSQsXG5cdFx0XHRvblJlcG9ydENvbmZpZyQsXG5cdFx0XHRmaWx0ZXJlZFJlc3VsdHNJZHMkLFxuXHRcdFx0b25Ub3RhbFJlc3VsdHNDaGFuZ2UkLFxuXHRcdFx0b25EZWxldGVSZXN1bHRCeUlkJCxcblx0XHRcdG9uRGVsZXRlUHJvY2Nlc3NGaW5pc2gkLFxuXHRcdH0gPSBjb3B5bGVha3NTZXJ2aWNlO1xuXHRcdG9uQ29tcGxldGVSZXN1bHQkLnBpcGUodW50aWxEZXN0cm95KHRoaXMpKS5zdWJzY3JpYmUoY29tcGxldGVSZXN1bHQgPT4gdGhpcy5zZXRDb21wbGV0ZVJlc3VsdChjb21wbGV0ZVJlc3VsdCkpO1xuXHRcdG9uUmVzdWx0UHJldmlldyQucGlwZSh1bnRpbERlc3Ryb3kodGhpcykpLnN1YnNjcmliZShwcmV2aWV3ID0+IHRoaXMuYWRkUHJldmlldyhwcmV2aWV3KSk7XG5cdFx0b25Qcm9ncmVzcyQucGlwZSh1bnRpbERlc3Ryb3kodGhpcykpLnN1YnNjcmliZShwcm9ncmVzcyA9PiB0aGlzLnNldFByb2dyZXNzKHByb2dyZXNzKSk7XG5cdFx0b25Ub3RhbFJlc3VsdHNDaGFuZ2UkLnBpcGUodW50aWxEZXN0cm95KHRoaXMpKS5zdWJzY3JpYmUodG90YWxSZXN1bHRzID0+IHRoaXMuc2V0VG90YWxSZXN1bHRzKHRvdGFsUmVzdWx0cykpO1xuXHRcdG9uUmVzdWx0SXRlbXMkLnBpcGUodW50aWxEZXN0cm95KHRoaXMpKS5zdWJzY3JpYmUocmVzdWx0SXRlbSA9PiB0aGlzLmFkZERvd25sb2FkZWRSZXN1bHRzKHJlc3VsdEl0ZW0pKTtcblx0XHRvblNjYW5Tb3VyY2UkLnBpcGUodW50aWxEZXN0cm95KHRoaXMpKS5zdWJzY3JpYmUoc291cmNlID0+IHRoaXMuc2V0U291cmNlKHNvdXJjZSkpO1xuXHRcdG9uUmVwb3J0Q29uZmlnJC5waXBlKHVudGlsRGVzdHJveSh0aGlzKSkuc3Vic2NyaWJlKGNvbmZpZyA9PiB0aGlzLmNvbmZpZ3VyZShjb25maWcpKTtcblx0XHR0aGlzLmNvbmZpZyQucGlwZSh1bnRpbERlc3Ryb3kodGhpcykpLnN1YnNjcmliZShjb25maWcgPT4gdGhpcy5fY29uZmlnQ2hhbmdlLm5leHQoY29uZmlnKSk7XG5cblx0XHRjb21iaW5lTGF0ZXN0KFt0aGlzLnNvdXJjZSQsIHRoaXMuY29tcGxldGVSZXN1bHQkXSlcblx0XHRcdC5waXBlKHVudGlsRGVzdHJveSh0aGlzKSwgdGFrZSgxKSlcblx0XHRcdC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5fcHJvZ3Jlc3MubmV4dCgxMDApKTtcblxuXHRcdGZpbHRlcmVkUmVzdWx0c0lkcyRcblx0XHRcdC5waXBlKHVudGlsRGVzdHJveSh0aGlzKSwgZGlzdGluY3RVbnRpbENoYW5nZWQoKSlcblx0XHRcdC5zdWJzY3JpYmUoaWRzID0+IHRoaXMuX2hpZGRlblJlc3VsdHMubmV4dChpZHMpKTtcblxuXHRcdG9uRGVsZXRlUmVzdWx0QnlJZCQucGlwZSh1bnRpbERlc3Ryb3kodGhpcykpLnN1YnNjcmliZShpZCA9PiB7XG5cdFx0XHRjb25zdCBjdXJyZW50Q29tcGxldGVSZXN1bHQgPSB0aGlzLl9jb21wbGV0ZVJlc3VsdC52YWx1ZTtcblxuXHRcdFx0Y29uc3Qgc3RhdGlzdGljcyA9IGhlbHBlcnMuY2FsY3VsYXRlU3RhdGlzdGljcyhcblx0XHRcdFx0Y3VycmVudENvbXBsZXRlUmVzdWx0LFxuXHRcdFx0XHR0aGlzLl9yZXN1bHRzLnZhbHVlLmZpbHRlcihyID0+IHIuaWQgIT09IGlkKSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHNob3dJZGVudGljYWw6IHRydWUsXG5cdFx0XHRcdFx0c2hvd01pbm9yQ2hhbmdlczogdHJ1ZSxcblx0XHRcdFx0XHRzaG93UGFnZVNvdXJjZXM6IHRydWUsXG5cdFx0XHRcdFx0c2hvd09ubHlUb3BSZXN1bHRzOiBmYWxzZSxcblx0XHRcdFx0XHRzaG93UmVsYXRlZDogdHJ1ZSxcblx0XHRcdFx0fVxuXHRcdFx0KTtcblxuXHRcdFx0dGhpcy5zZXRDb21wbGV0ZVJlc3VsdCh7XG5cdFx0XHRcdC4uLmN1cnJlbnRDb21wbGV0ZVJlc3VsdCxcblx0XHRcdFx0c2Nhbm5lZERvY3VtZW50OiB7XG5cdFx0XHRcdFx0Li4uY3VycmVudENvbXBsZXRlUmVzdWx0LnNjYW5uZWREb2N1bWVudCxcblx0XHRcdFx0XHR0b3RhbFdvcmRzOiBzdGF0aXN0aWNzLnRvdGFsLFxuXHRcdFx0XHRcdHRvdGFsRXhjbHVkZWQ6IHN0YXRpc3RpY3Mub21pdHRlZFdvcmRzLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHRyZXN1bHRzOiB7XG5cdFx0XHRcdFx0Li4uY3VycmVudENvbXBsZXRlUmVzdWx0LnJlc3VsdHMsXG5cdFx0XHRcdFx0YmF0Y2g6IGN1cnJlbnRDb21wbGV0ZVJlc3VsdC5yZXN1bHRzLmJhdGNoLmZpbHRlcihyID0+IHIuaWQgIT09IGlkKSxcblx0XHRcdFx0XHRpbnRlcm5ldDogY3VycmVudENvbXBsZXRlUmVzdWx0LnJlc3VsdHMuaW50ZXJuZXQuZmlsdGVyKHIgPT4gci5pZCAhPT0gaWQpLFxuXHRcdFx0XHRcdGRhdGFiYXNlOiBjdXJyZW50Q29tcGxldGVSZXN1bHQucmVzdWx0cy5kYXRhYmFzZS5maWx0ZXIociA9PiByLmlkICE9PSBpZCksXG5cdFx0XHRcdFx0cmVwb3NpdG9yaWVzOiBjdXJyZW50Q29tcGxldGVSZXN1bHQucmVzdWx0cy5yZXBvc2l0b3JpZXM/LmZpbHRlcihyID0+IHIuaWQgIT09IGlkKSxcblx0XHRcdFx0XHRzY29yZToge1xuXHRcdFx0XHRcdFx0Li4uY3VycmVudENvbXBsZXRlUmVzdWx0LnJlc3VsdHMuc2NvcmUsXG5cdFx0XHRcdFx0XHRhZ2dyZWdhdGVkU2NvcmU6IHN0YXRpc3RpY3MuYWdncmVnYXRlZFNjb3JlLFxuXHRcdFx0XHRcdFx0aWRlbnRpY2FsV29yZHM6IHN0YXRpc3RpY3MuaWRlbnRpY2FsLFxuXHRcdFx0XHRcdFx0cmVsYXRlZE1lYW5pbmdXb3Jkczogc3RhdGlzdGljcy5yZWxhdGVkTWVhbmluZyxcblx0XHRcdFx0XHRcdG1pbm9yQ2hhbmdlZFdvcmRzOiBzdGF0aXN0aWNzLm1pbm9yQ2hhbmdlcyxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9LFxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuX3Jlc3VsdHMubmV4dCh0aGlzLl9yZXN1bHRzLnZhbHVlLmZpbHRlcihyID0+IHIuaWQgIT09IGlkKSk7XG5cblx0XHRcdG9uRGVsZXRlUHJvY2Nlc3NGaW5pc2gkLm5leHQodGhpcy5fY29tcGxldGVSZXN1bHQudmFsdWUpO1xuXHRcdH0pO1xuXHR9XG5cblx0cHVibGljIGNvbXBsZXRlUmVzdWx0JDogT2JzZXJ2YWJsZTxDb21wbGV0ZVJlc3VsdD4gPSB0aGlzLl9jb21wbGV0ZVJlc3VsdC5hc09ic2VydmFibGUoKS5waXBlKHRydXRoeSgpKTtcblxuXHRwdWJsaWMgdG90YWxSZXN1bHRzJCA9IHRoaXMuX3RvdGFsUmVzdWx0cy5hc09ic2VydmFibGUoKTtcblxuXHRwdWJsaWMgc291cmNlJCA9IHRoaXMuX3NvdXJjZS5hc09ic2VydmFibGUoKS5waXBlKHRydXRoeSgpLCB0YWtlKDEpKTtcblx0cHVibGljIHByb2dyZXNzJCA9IHRoaXMuX3Byb2dyZXNzLmFzT2JzZXJ2YWJsZSgpO1xuXG5cdC8qKiBjb25maWcgb2JzZXJ2YWJsZSAqL1xuXHRwdWJsaWMgY29uZmlnJCA9IHRoaXMuX2NvbmZpZy5hc09ic2VydmFibGUoKTtcblx0LyoqIHN1YiBjb25maWcgb2JzZXJ2ZWFibGVzICovXG5cdHB1YmxpYyBjb250ZW50TW9kZSQgPSB0aGlzLmNvbmZpZyQucGlwZShtYXAoeCA9PiB4LmNvbnRlbnRNb2RlKSk7XG5cblx0cHVibGljIHZpZXdNb2RlJCA9IHRoaXMuY29uZmlnJC5waXBlKG1hcCh4ID0+IHgudmlld01vZGUpKTtcblx0cHVibGljIHZpZXdNb2RlID0gdGhpcy5fY29uZmlnLnZhbHVlLnZpZXdNb2RlO1xuXG5cdHB1YmxpYyBzdXNwZWN0SWQkID0gdGhpcy5jb25maWckLnBpcGUobWFwKHggPT4geC5zdXNwZWN0SWQpKTtcblx0cHVibGljIGhlbHAkID0gdGhpcy5jb25maWckLnBpcGUobWFwKHggPT4geC5oZWxwKSk7XG5cdHB1YmxpYyBkb3dubG9hZCQgPSB0aGlzLmNvbmZpZyQucGlwZShtYXAoeCA9PiB4LmRvd25sb2FkKSk7XG5cdHB1YmxpYyBzZXR0aW5ncyQgPSB0aGlzLmNvbmZpZyQucGlwZShtYXAoeCA9PiB4LnNldHRpbmdzKSk7XG5cdHB1YmxpYyBzaGFyZSQgPSB0aGlzLmNvbmZpZyQucGlwZShtYXAoeCA9PiB4LnNoYXJlKSk7XG5cdHB1YmxpYyBvcHRpb25zJCA9IHRoaXMuY29uZmlnJC5waXBlKG1hcCh4ID0+IHgub3B0aW9ucykpO1xuXHRwdWJsaWMgcmVzdWx0Q2FyZEFjdGlvbnMkID0gdGhpcy5jb25maWckLnBpcGUobWFwKHggPT4geC5yZXN1bHRDYXJkQWN0aW9ucykpO1xuXHRwdWJsaWMgb25seU9uZVRvT25lJCA9IHRoaXMuY29uZmlnJC5waXBlKG1hcCh4ID0+IHguZGlzYWJsZVN1c3BlY3RCYWNrQnV0dG9uKSk7XG5cdHB1YmxpYyBzb3VyY2VQYWdlJCA9IHRoaXMuY29uZmlnJC5waXBlKG1hcCh4ID0+IHguc291cmNlUGFnZSkpO1xuXHRwdWJsaWMgc3VzcGVjdFBhZ2UkID0gdGhpcy5jb25maWckLnBpcGUobWFwKHggPT4geC5zdXNwZWN0UGFnZSkpO1xuXHRwdWJsaWMgc3VzcGVjdFJlc3VsdCQ6IE9ic2VydmFibGU8UmVzdWx0SXRlbT4gPSB0aGlzLnN1c3BlY3RJZCQucGlwZShcblx0XHRzd2l0Y2hNYXAoaWQgPT4gKGlkID8gdGhpcy5maW5kUmVzdWx0QnlJZCQoaWQpIDogb2YobnVsbCkpKVxuXHQpO1xuXHRwdWJsaWMgc3VzcGVjdFByZXZpZXckOiBPYnNlcnZhYmxlPFJlc3VsdFByZXZpZXc+ID0gdGhpcy5zdXNwZWN0SWQkLnBpcGUoXG5cdFx0c3dpdGNoTWFwKGlkID0+IChpZCA/IHRoaXMuZmluZFByZXZpZXdCeUlkJChpZCkgOiBvZihudWxsKSkpXG5cdCk7XG5cblx0cHVibGljIGhpZGRlblJlc3VsdHMkID0gdGhpcy5faGlkZGVuUmVzdWx0cy5hc09ic2VydmFibGUoKS5waXBlKGRpc3RpbmN0VW50aWxDaGFuZ2VkKCkpO1xuXHRwdWJsaWMgcmVzdWx0cyQgPSB0aGlzLl9yZXN1bHRzLmFzT2JzZXJ2YWJsZSgpLnBpcGUodHJ1dGh5KCkpO1xuXHRwdWJsaWMgcHJldmlld3MkID0gdGhpcy5fcHJldmlld3MuYXNPYnNlcnZhYmxlKCkucGlwZSh0cnV0aHkoKSk7XG5cblx0cHVibGljIGZpbHRlcmVkUHJldmlld3MkID0gY29tYmluZUxhdGVzdChbdGhpcy5wcmV2aWV3cyQsIHRoaXMuaGlkZGVuUmVzdWx0cyRdKS5waXBlKFxuXHRcdG1hcCgoW3Jlc3VsdHMsIGlkc10pID0+IHJlc3VsdHMuZmlsdGVyKHJlc3VsdCA9PiAhaWRzLmluY2x1ZGVzKHJlc3VsdC5pZCkpKVxuXHQpO1xuXHRwdWJsaWMgZmlsdGVyZWRSZXN1bHRzJCA9IGNvbWJpbmVMYXRlc3QoW3RoaXMucmVzdWx0cyQsIHRoaXMuaGlkZGVuUmVzdWx0cyRdKS5waXBlKFxuXHRcdG1hcCgoW3Jlc3VsdHMsIGlkc10pID0+IHJlc3VsdHMuZmlsdGVyKHJlc3VsdCA9PiAhaWRzLmluY2x1ZGVzKHJlc3VsdC5pZCkpKVxuXHQpO1xuXG5cdHB1YmxpYyBoZWxwQ2xpY2skID0gdGhpcy5faGVscENsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuXHRwdWJsaWMgZG93bmxvYWRDbGljayQgPSB0aGlzLl9kb3dubG9hZENsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuXHRwdWJsaWMgcGxhblVwZ3JhZGVFdmVudCQgPSB0aGlzLl9wbGFuVXBncmFkZUV2ZW50LmFzT2JzZXJ2YWJsZSgpO1xuXHRwdWJsaWMgc2hhcmVDbGljayQgPSB0aGlzLl9zaGFyZUNsaWNrLmFzT2JzZXJ2YWJsZSgpO1xuXHRwdWJsaWMgY29uZmlnQ2hhbmdlJCA9IHRoaXMuX2NvbmZpZ0NoYW5nZS5hc09ic2VydmFibGUoKTtcblxuXHQvKipcblx0ICogR2V0IGFuIG9ic2VydmFibGUgb2Ygc29tZSByZXN1bHQgYnkgaWRcblx0ICogVGhlIG9ic2VydmFibGUgY29tcGxldGVzIGFmdGVyIGVtaXR0aW5nIHRoZSByZXN1bHRcblx0ICogQHBhcmFtIGlkIHRoZSByZXN1bHQgaWRcblx0ICovXG5cdHB1YmxpYyBmaW5kUmVzdWx0QnlJZCQoaWQ6IHN0cmluZykge1xuXHRcdHJldHVybiB0aGlzLnJlc3VsdHMkLnBpcGUoXG5cdFx0XHRtYXAocmVzdWx0cyA9PiByZXN1bHRzLmZpbmQocmVzID0+IHJlcy5pZCA9PT0gaWQpKSxcblx0XHRcdHRydXRoeSgpLFxuXHRcdFx0dGFrZSgxKVxuXHRcdCk7XG5cdH1cblxuXHQvKipcblx0ICogR2V0IGFuIG9ic2VydmFibGUgb2Ygc29tZSBwcmV2aWV3IGJ5IGlkXG5cdCAqIFRoZSBvYnNlcnZhYmxlIGNvbXBsZXRlcyBhZnRlciBlbWl0dGluZyB0aGUgcmVzdWx0XG5cdCAqIEBwYXJhbSBpZCB0aGUgcHJldmlldyBpZFxuXHQgKi9cblx0cHVibGljIGZpbmRQcmV2aWV3QnlJZCQoaWQ6IHN0cmluZykge1xuXHRcdHJldHVybiB0aGlzLl9wcmV2aWV3cy5waXBlKFxuXHRcdFx0dHJ1dGh5KCksXG5cdFx0XHRtYXAocHJldmlldyA9PiBwcmV2aWV3LmZpbmQocmVzID0+IHJlcy5pZCA9PT0gaWQpKSxcblx0XHRcdHRha2UoMSlcblx0XHQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFB1c2hlcyBhIG5ldyBjb21wbGV0ZSByZXN1bHQgdGhhdCBjb250YWlucyB0aGUgcmVwb3J0IGBtZXRhZGF0YWAgYW5kIHVwZGF0ZXMgdGhlIG1ldGFkYXRhIG9ic2VydmVyLlxuXHQgKiBAcGFyYW0gY29tcGxldGVSZXN1bHQgdGhlIGNvbXBsZXRlIHJlc3VsdCBvYmplY3Rcblx0ICovXG5cdHB1YmxpYyBzZXRDb21wbGV0ZVJlc3VsdChjb21wbGV0ZVJlc3VsdDogQ29tcGxldGVSZXN1bHQpIHtcblx0XHRjb25zdCB7IGludGVybmV0LCBkYXRhYmFzZSwgYmF0Y2gsIHJlcG9zaXRvcmllcyB9ID0gY29tcGxldGVSZXN1bHQucmVzdWx0cztcblx0XHRjb25zdCBwcmV2aWV3cyA9IFtcblx0XHRcdC4uLihyZXBvc2l0b3JpZXMgJiYgcmVwb3NpdG9yaWVzLmxlbmd0aFxuXHRcdFx0XHQ/IHJlcG9zaXRvcmllcy5tYXAociA9PiAoeyAuLi5yLCB0eXBlOiBFUmVzdWx0UHJldmlld1R5cGUuUmVwb3NpdHJveSB9KSlcblx0XHRcdFx0OiBbXSksXG5cdFx0XHQuLi5pbnRlcm5ldC5tYXAociA9PiAoeyAuLi5yLCB0eXBlOiBFUmVzdWx0UHJldmlld1R5cGUuSW50ZXJuZXQgfSkpLFxuXHRcdFx0Li4uZGF0YWJhc2UubWFwKHIgPT4gKHsgLi4uciwgdHlwZTogRVJlc3VsdFByZXZpZXdUeXBlLkRhdGFiYXNlIH0pKSxcblx0XHRcdC4uLmJhdGNoLm1hcChyID0+ICh7IC4uLnIsIHR5cGU6IEVSZXN1bHRQcmV2aWV3VHlwZS5CYXRjaCB9KSksXG5cdFx0XTtcblxuXHRcdHByZXZpZXdzLnNvcnQoKGEsIGIpID0+IGEubWF0Y2hlZFdvcmRzIC0gYi5tYXRjaGVkV29yZHMpLmZvckVhY2gocHJldmlldyA9PiB0aGlzLmFkZFByZXZpZXcocHJldmlldykpO1xuXHRcdHRoaXMuX3ByZXZpZXdzLm5leHQocHJldmlld3MpO1xuXHRcdGlmICghY29tcGxldGVSZXN1bHQuc2Nhbm5lZERvY3VtZW50LmNyZWF0aW9uVGltZS5lbmRzV2l0aCgnWicpKSB7XG5cdFx0XHRjb21wbGV0ZVJlc3VsdC5zY2FubmVkRG9jdW1lbnQuY3JlYXRpb25UaW1lICs9ICdaJztcblx0XHR9XG5cblx0XHRpZiAoY29tcGxldGVSZXN1bHQuZmlsdGVycyAmJiBjb21wbGV0ZVJlc3VsdC5maWx0ZXJzLnJlc3VsdElkcykge1xuXHRcdFx0dGhpcy5zZXRIaWRkZW5SZXN1bHRzKGNvbXBsZXRlUmVzdWx0LmZpbHRlcnMucmVzdWx0SWRzKTtcblx0XHR9XG5cblx0XHR0aGlzLl9jb21wbGV0ZVJlc3VsdC5uZXh0KGNvbXBsZXRlUmVzdWx0KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBzZXQgdGhlIHRvdGFsIHJlc3VsdHMgb2JzZXJ2ZXJcblx0ICogQHBhcmFtIHRvdGFsUmVzdWx0cyB0aGUgdG90YWwgcmVzdWx0cyBhbW91bnRcblx0ICovXG5cdHB1YmxpYyBzZXRUb3RhbFJlc3VsdHModG90YWxSZXN1bHRzOiBudW1iZXIpIHtcblx0XHR0aGlzLl90b3RhbFJlc3VsdHMubmV4dCh0b3RhbFJlc3VsdHMpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFB1c2hlcyBhIG5ldyBzY2FuIGBzb3VyY2VgIHRvIHRoZSBzb3VyY2Ugb2JzZXJ2ZXJcblx0ICogQHBhcmFtIHNvdXJjZSB0aGUgc2Nhbm5lZCBkb2N1bWVudCBzb3VyY2Vcblx0ICovXG5cdHB1YmxpYyBzZXRTb3VyY2Uoc291cmNlOiBTY2FuU291cmNlKSB7XG5cdFx0dGhpcy5fc291cmNlLm5leHQoc291cmNlKTtcblx0XHQvKiogU3dpdGNoIHRvIHRleHQgaW4gY2FzZSBubyBodG1sIGV4aXN0cyAqL1xuXHRcdGlmIChzb3VyY2UgJiYgKCFzb3VyY2UuaHRtbCB8fCAhc291cmNlLmh0bWwudmFsdWUpICYmIHRoaXMuX2NvbmZpZy52YWx1ZS5jb250ZW50TW9kZSA9PT0gJ2h0bWwnKSB7XG5cdFx0XHR0aGlzLmNvbmZpZ3VyZSh7IGNvbnRlbnRNb2RlOiAndGV4dCcgfSk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFB1c2hlcyBhIG5ldyBudW1iZXIgdG8gdGhlIGBwcm9ncmVzc2Agb2JzZXJ2ZXJcblx0ICogU2hvdWxkIGJlIGEgcG9zaXRpdmUgaW50ZWdlciBiZXR3ZWVuIDAgYW5kIDEwMDtcblx0ICogaWYgYHByb2dyZXNzYCBpcyBlcXVhbCB0byAxMDAgdGhlbiB0aGUgcHJvZ3Jlc3Mgb2JzZXJ2ZXIgd2lsbCBjb21wbGV0ZS5cblx0ICogKFRoaXMgYmVoYXZpb3VyIG1pZ2h0IGNoYW5nZSBpbiB0aGUgZnV0dXJlKVxuXHQgKiBAcGFyYW0gcHJvZ3Jlc3MgdGhlIHByb2dyZXNzIHRvIGRpc3BsYXlcblx0ICovXG5cdHB1YmxpYyBzZXRQcm9ncmVzcyhwcm9ncmVzczogbnVtYmVyKSB7XG5cdFx0dGhpcy5fcHJvZ3Jlc3MubmV4dChwcm9ncmVzcyk7XG5cdH1cblxuXHQvKipcblx0ICogUHVzaGVzIGEgbmV3IGxpc3Qgb2YgYGlkc2AgdG8gdGhlIGhpZGRlbiByZXN1bHRzIG9ic2VydmVyXG5cdCAqIEBwYXJhbSBpZHMgdGhlIGlkcyB0byBoaWRlXG5cdCAqL1xuXHRwdWJsaWMgc2V0SGlkZGVuUmVzdWx0cyhpZHM6IHN0cmluZ1tdKSB7XG5cdFx0Y29uc3QgY3VycmVudENvbXBsZXRlUmVzdWx0ID0gdGhpcy5fY29tcGxldGVSZXN1bHQ/LnZhbHVlO1xuXHRcdGxldCBhZ2dyZWdhdGVkU2NvcmUgPSBudWxsO1xuXHRcdGlmIChjdXJyZW50Q29tcGxldGVSZXN1bHQpIHtcblx0XHRcdGNvbnN0IHN0YXRpc3RpY3MgPSBoZWxwZXJzLmNhbGN1bGF0ZVN0YXRpc3RpY3MoXG5cdFx0XHRcdGN1cnJlbnRDb21wbGV0ZVJlc3VsdCxcblx0XHRcdFx0dGhpcy5fcmVzdWx0cy52YWx1ZS5maWx0ZXIociA9PiAhaWRzLmluY2x1ZGVzKHIuaWQpKSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHNob3dJZGVudGljYWw6IHRydWUsXG5cdFx0XHRcdFx0c2hvd01pbm9yQ2hhbmdlczogdHJ1ZSxcblx0XHRcdFx0XHRzaG93UGFnZVNvdXJjZXM6IHRydWUsXG5cdFx0XHRcdFx0c2hvd09ubHlUb3BSZXN1bHRzOiBmYWxzZSxcblx0XHRcdFx0XHRzaG93UmVsYXRlZDogdHJ1ZSxcblx0XHRcdFx0fVxuXHRcdFx0KTtcblx0XHRcdGFnZ3JlZ2F0ZWRTY29yZSA9IHN0YXRpc3RpY3MuYWdncmVnYXRlZFNjb3JlO1xuXHRcdH1cblx0XHR0aGlzLmNvcHlsZWFrc1NlcnZpY2Uuc2V0RmlsdGVyZWRSZXN1bHRzSWRzKGlkcywgYWdncmVnYXRlZFNjb3JlKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBQdXNoZXMgYSBuZXcgYGV2ZW50YCB0byB0aGUgaGVscC1jbGljayBvYnNlcnZlciwgaW5kaWNhdGluZyB0aGUgaGVscCBidXR0b24gd2FzIGNsaWNrZWRcblx0ICogQHBhcmFtIGV2ZW50IG5hdGl2ZSBjbGljayBldmVudFxuXHQgKi9cblx0cHVibGljIGhlbHBCdG5DbGlja2VkKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG5cdFx0dGhpcy5faGVscENsaWNrLm5leHQoZXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFB1c2hlcyBhIG5ldyBgZXZlbnRgIHRvIHRoZSBzaGFyZS1jbGljayBvYnNlcnZlciwgaW5kaWNhdGluZyB0aGUgc2hhcmUgYnV0dG9uIHdhcyBjbGlja2VkXG5cdCAqIEBwYXJhbSBldmVudCBuYXRpdmUgY2xpY2sgZXZlbnRcblx0ICovXG5cdHB1YmxpYyBzaGFyZUJ0bkNsaWNrZWQoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcblx0XHR0aGlzLl9zaGFyZUNsaWNrLm5leHQoZXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFB1c2hlcyBhIG5ldyBgZXZlbnRgIHRvIHRoZSBkb3dubG9hZC1jbGljayBvYnNlcnZlciwgaW5kaWNhdGluZyB0aGUgZG93bmxvYWQgYnV0dG9uIHdhcyBjbGlja2VkXG5cdCAqIEBwYXJhbSBldmVudCBuYXRpdmUgY2xpY2sgZXZlbnRcblx0ICovXG5cdHB1YmxpYyBkb3dubG9hZEJ0bkNsaWNrZWQoZXZlbnQ6IE1vdXNlRXZlbnQpIHtcblx0XHR0aGlzLl9kb3dubG9hZENsaWNrLm5leHQoZXZlbnQpO1xuXHR9XG5cblx0LyoqXG5cdCAqIFB1c2hlcyBhIG5ldyBgZXZlbnRgIHRvIHRoZSBwbGFuLXVwZ3JhZGUgZXZlbnQgb2JzZXJ2ZXIsIGluZGljYXRpbmcgdGhlIHBsYW4tdXBncmFkZSBldmVudCBidXR0b24gd2FzIGNsaWNrZWRcblx0ICovXG5cdHB1YmxpYyB1cGdyYWRlUGxhbkV2ZW50KCkge1xuXHRcdGNvbnN0IGNvbXBsZXRlUmVzdWx0ID0gdGhpcy5fY29tcGxldGVSZXN1bHQ/LnZhbHVlO1xuXHRcdGxldCByZWNvbW1lbmRlZFBhZ2VzQW1vdW50ID0gY29tcGxldGVSZXN1bHQuc2Nhbm5lZERvY3VtZW50Py5jcmVkaXRzO1xuXHRcdGlmIChjb21wbGV0ZVJlc3VsdD8uc2Nhbm5lZERvY3VtZW50Py5leHBlY3RlZENyZWRpdHMpIHtcblx0XHRcdHJlY29tbWVuZGVkUGFnZXNBbW91bnQgPVxuXHRcdFx0XHRjb21wbGV0ZVJlc3VsdD8uc2Nhbm5lZERvY3VtZW50Py5leHBlY3RlZENyZWRpdHMgLSBjb21wbGV0ZVJlc3VsdC5zY2FubmVkRG9jdW1lbnQ/LmNyZWRpdHM7XG5cdFx0fVxuXHRcdHRoaXMuX3BsYW5VcGdyYWRlRXZlbnQubmV4dChyZWNvbW1lbmRlZFBhZ2VzQW1vdW50KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBQdXNoIGEgbmV3IGBwcmV2aWV3YCBvZiBhIHJlc3VsdCB0byB0aGUgcHJldmlld3Mgb2JzZXJ2ZXJcblx0ICogVGhpcyBmdW5jdGlvbiBkb2VzIG5vdGhpbmcgaWYgdGhlIGNvbXBsZXRlIHJlc3VsdCBpcyByZWFkeVxuXHQgKiBvciBpZiB0aGUgcHJldmlldyB3YXMgYWxscmVhZHkgcHVzaGVkXG5cdCAqIEBwYXJhbSBwcmV2aWV3IHRoZSBwcmV2aWV3IHRvIHB1c2ggbmV4dFxuXHQgKi9cblx0cHVibGljIGFkZFByZXZpZXcocHJldmlldzogUmVzdWx0UHJldmlldykge1xuXHRcdGlmICghdGhpcy5fY29tcGxldGVSZXN1bHQudmFsdWUgJiYgISh0aGlzLl9wcmV2aWV3cy52YWx1ZSB8fCBbXSkuZmluZChwID0+IHAuaWQgPT09IHByZXZpZXcuaWQpKSB7XG5cdFx0XHR0aGlzLl9wcmV2aWV3cy5uZXh0KFsuLi4odGhpcy5fcHJldmlld3MudmFsdWUgfHwgW10pLCBwcmV2aWV3XSk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIFB1c2hlcyBhbiBhcnJheSBvZiBuZXcgYHJlc3VsdGBzIHRvIHRoZSByZXN1bHRzIG9ic2VydmFibGVcblx0ICogQHBhcmFtIHJlc3VsdEl0ZW1zIGFuIGFycmF5IGNvbnRhaW5pbmcgcmVzdWx0SXRlbSBlbGVtZW50c1xuXHQgKi9cblx0cHVibGljIGFkZERvd25sb2FkZWRSZXN1bHRzKHJlc3VsdEl0ZW1zOiBSZXN1bHRJdGVtW10pIHtcblx0XHRjb25zdCBuZXdJdGVtcyA9IHJlc3VsdEl0ZW1zLmZpbHRlcihyZXMgPT4gIXRoaXMuX3Jlc3VsdHMudmFsdWUuZmluZCh4ID0+IHguaWQgPT09IHJlcy5pZCkpO1xuXHRcdGlmIChuZXdJdGVtcy5sZW5ndGgpIHtcblx0XHRcdHRoaXMuX3Jlc3VsdHMubmV4dChbLi4udGhpcy5fcmVzdWx0cy52YWx1ZSwgLi4ubmV3SXRlbXNdKTtcblx0XHR9XG5cdH1cblxuXHQvKipcblx0ICogRWRpdCB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgcmVwb3J0IHVzaW5nIGVpdGhlciBhIGZ1bGwgb3IgcGFydGlhbCBjb25maWd1cmF0aW9uIG9iamVjdFxuXHQgKiBAcGFyYW0gY29uZmlnIHRoZSBjb25maWd1cmF0aW9uIG9iamVjdFxuXHQgKi9cblx0cHVibGljIGNvbmZpZ3VyZShjb25maWc6IENvcHlsZWFrc1JlcG9ydENvbmZpZykge1xuXHRcdHRoaXMuX2NvbmZpZy5uZXh0KE9iamVjdC5hc3NpZ24odGhpcy5fY29uZmlnLnZhbHVlLCBjb25maWcpKTtcblx0fVxuXG5cdHB1YmxpYyBoYXNOb25BSUFsZXJ0cygpIHtcblx0XHRjb25zdCBjb21wbGV0ZVJlc3VsdCA9IHRoaXMuX2NvbXBsZXRlUmVzdWx0LnZhbHVlO1xuXHRcdGlmIChjb21wbGV0ZVJlc3VsdD8ubm90aWZpY2F0aW9ucz8uYWxlcnRzPy5maWx0ZXIocyA9PiBzLmNvZGUgIT0gQUxFUlRTLlNVU1BFQ1RFRF9BSV9URVhUX0RFVEVDVEVEKS5sZW5ndGggPiAwKSB7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cHVibGljIGlzUGxhZ2lhcmlzbUVuYWJsZWQoKSB7XG5cdFx0Y29uc3QgY29tcGxldGVSZXN1bHQgPSB0aGlzLl9jb21wbGV0ZVJlc3VsdC52YWx1ZTtcblx0XHRpZiAoY29tcGxldGVSZXN1bHQpIHtcblx0XHRcdGlmIChjb21wbGV0ZVJlc3VsdD8uc2Nhbm5lZERvY3VtZW50Py5lbmFibGVkPy5wbGFnaWFyaXNtRGV0ZWN0aW9uICE9IG51bGwpXG5cdFx0XHRcdHJldHVybiBjb21wbGV0ZVJlc3VsdD8uc2Nhbm5lZERvY3VtZW50Py5lbmFibGVkPy5wbGFnaWFyaXNtRGV0ZWN0aW9uO1xuXHRcdH1cblx0XHRyZXR1cm4gdHJ1ZTtcblx0fVxuXG5cdHB1YmxpYyBpc0FpRGV0ZWN0aW9uRW5hYmxlZCgpIHtcblx0XHRjb25zdCBjb21wbGV0ZVJlc3VsdCA9IHRoaXMuX2NvbXBsZXRlUmVzdWx0LnZhbHVlO1xuXHRcdGlmIChjb21wbGV0ZVJlc3VsdCkge1xuXHRcdFx0aWYgKGNvbXBsZXRlUmVzdWx0Py5zY2FubmVkRG9jdW1lbnQ/LmVuYWJsZWQ/LmFpRGV0ZWN0aW9uKSByZXR1cm4gdHJ1ZTtcblxuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0Y29tcGxldGVSZXN1bHQ/Lm5vdGlmaWNhdGlvbnM/LmFsZXJ0cz8ubGVuZ3RoICYmXG5cdFx0XHRcdGNvbXBsZXRlUmVzdWx0Py5ub3RpZmljYXRpb25zPy5hbGVydHMuZmlsdGVyKGFsZXJ0ID0+IGFsZXJ0LmNvZGUgPT0gQUxFUlRTLlNVU1BFQ1RFRF9BSV9URVhUX0RFVEVDVEVEKS5sZW5ndGggPT1cblx0XHRcdFx0XHQxXG5cdFx0XHQpO1xuXHRcdH1cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRwdWJsaWMgZ2V0QWlTY29yZSgpIHtcblx0XHRpZiAodGhpcy5pc0FpRGV0ZWN0aW9uRW5hYmxlZCgpKSB7XG5cdFx0XHRjb25zdCBjb21wbGV0ZVJlc3VsdCA9IHRoaXMuX2NvbXBsZXRlUmVzdWx0LnZhbHVlO1xuXHRcdFx0Y29uc3QgYWlBbGVydCA9IGNvbXBsZXRlUmVzdWx0Lm5vdGlmaWNhdGlvbnMuYWxlcnRzLmZpbmQoXG5cdFx0XHRcdGFsZXJ0ID0+IGFsZXJ0LmNvZGUgPT0gQUxFUlRTLlNVU1BFQ1RFRF9BSV9URVhUX0RFVEVDVEVEXG5cdFx0XHQpO1xuXHRcdFx0aWYgKGFpQWxlcnQpIHtcblx0XHRcdFx0Y29uc3QgYWlEYXRhID0gSlNPTi5wYXJzZShhaUFsZXJ0LmFkZGl0aW9uYWxEYXRhKSBhcyBBSVNjYW5SZXN1bHQ7XG5cdFx0XHRcdHJldHVybiBhaURhdGEuc3VtbWFyeS5haTtcblx0XHRcdH1cblx0XHRcdHJldHVybiAwO1xuXHRcdH1cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdC8qKiBDb21wbGV0ZXMgYWxsIHN1YmplY3RzIHRvIHByZXZlbnQgbWVtb3J5IGxlYWsgKi9cblx0cHVibGljIGNsZWFudXAoKSB7XG5cdFx0dGhpcy5fY29uZmlnLmNvbXBsZXRlKCk7XG5cdFx0dGhpcy5fY29tcGxldGVSZXN1bHQuY29tcGxldGUoKTtcblx0XHR0aGlzLl9zb3VyY2UuY29tcGxldGUoKTtcblx0XHR0aGlzLl9wcmV2aWV3cy5jb21wbGV0ZSgpO1xuXHRcdHRoaXMuX3Jlc3VsdHMuY29tcGxldGUoKTtcblx0XHR0aGlzLl9wcm9ncmVzcy5jb21wbGV0ZSgpO1xuXHRcdHRoaXMuX3RvdGFsUmVzdWx0cy5jb21wbGV0ZSgpO1xuXHRcdHRoaXMuX2hpZGRlblJlc3VsdHMuY29tcGxldGUoKTtcblx0XHR0aGlzLl9kb3dubG9hZENsaWNrLmNvbXBsZXRlKCk7XG5cdFx0dGhpcy5fc2hhcmVDbGljay5jb21wbGV0ZSgpO1xuXHRcdHRoaXMuX2NvbmZpZ0NoYW5nZS5jb21wbGV0ZSgpO1xuXHR9XG5cblx0LyoqIENsZWFuIGFsbCBzdWJqZWN0cyBhbmQgbm90aWZ5IHRoYXQgdGhlIHJlcG9ydCBoYXMgYmVlbiBkZXN0cm95ZWQgKi9cblx0bmdPbkRlc3Ryb3koKSB7XG5cdFx0dGhpcy5jbGVhbnVwKCk7XG5cdFx0dGhpcy5jb3B5bGVha3NTZXJ2aWNlLm5vdGlmeURlc3Ryb3koKTtcblx0fVxufVxuIl19