/**
 * document ready event handler
 * @param fn the callback to execute when the document is ready
 */
function onDocumentReady(fn) {
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(fn, 1);
    }
    else {
        document.addEventListener('DOMContentLoaded', fn);
    }
}
/**
 * Callback to execute when the document is ready
 */
function ready() {
    let current;
    let matches;
    let isPdf = document.querySelector('meta[content="pdf2htmlEX"]') !== null;
    window.addEventListener('message', onMessageFromParent);
    init();
    /**
     * Initialization code, will execute before emitting iframe-ready event
     */
    function init() {
        Array.from(document.links).forEach(x => {
            x.href = 'javascript:void(0)';
            x.title = 'disable link';
        }); // disable links
        matches = Array.from(document.querySelectorAll('span[match]'));
        matches.forEach(elem => {
            elem.addEventListener('click', onMatchClick);
            elem.addEventListener('mouseenter', onMatchHover);
            elem.addEventListener('mouseleave', onMatchHover);
        });
        document.querySelectorAll('span[exclude-partial-scan]').forEach(elem => {
            elem.addEventListener('click', () => messageParent({ type: 'upgrade-plan' }));
            elem.addEventListener('mouseenter', onMatchHover);
            elem.addEventListener('mouseleave', onMatchHover);
        });
    }
    /**
     * Message event handler
     */
    function onMessageFromParent(nativeEvent) {
        if (nativeEvent.source !== window.parent) {
            return;
        }
        const event = nativeEvent.data;
        switch (event.type) {
            case 'match-select':
                handleBroadcastMatchSelect(event);
                break;
            case 'match-jump':
                onMatchJump(event);
                break;
            default:
                console.error('unknown event in frame', nativeEvent);
        }
    }
    /**
     * handle a broadcasted `match-select` event
     * @param event the match select event
     */
    function handleBroadcastMatchSelect(event) {
        const elem = document.querySelector(`span[match][data-index='${event.index}']`);
        if (!elem && event.index !== -1) {
            messageParent({ type: 'match-warn' });
        }
        onMatchSelect(elem, true); // should not rebroadcast
    }
    /**
     * Event handler for a `MatchJumpEvent` that is fired when the user clicks the
     * go to next/prev match buttons
     */
    function onMatchJump(event) {
        if (!current) {
            onMatchSelect(matches[0]);
            return;
        }
        const first = matches[0];
        const last = matches[matches.length - 1];
        if ((current === first && !event.forward) || (current === last && event.forward)) {
            return;
        }
        const currentIndex = matches.indexOf(current);
        const nextIndex = currentIndex + (event.forward ? 1 : -1);
        onMatchSelect(matches[nextIndex]);
    }
    /**
     * Emits an event to the parent window using PostMessage API
     * @param event the event content to emit
     */
    function messageParent(event) {
        window.parent.postMessage(event, '*');
    }
    /**
     * Event handler for the default click event of a match
     * @param event the default mouse event object
     */
    function onMatchClick(event) {
        const elem = event.target;
        onMatchSelect(elem);
    }
    /**
     * Execute the logic of a match selection.
     * - highlight `elem` and message the parent window about it
     * - if an element is allready highlighted turn it off and highlight `elem`
     * @param elem the selected element
     */
    function onMatchSelect(elem, broadcast = false) {
        if (!broadcast && current === elem) {
            current.toggleAttribute('on', false);
            current = null;
            messageParent({ type: 'match-select', index: -1 });
            return;
        }
        if (!broadcast && current) {
            current.toggleAttribute('on', false);
        }
        current = elem;
        current.toggleAttribute('on', true);
        if (isPdf) {
            elem.closest('.pc').classList.add('opened');
        }
        current.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        messageParent({ type: 'match-select', index: +current.dataset.index });
    }
    /**
     * Event handler for the default `mouseenter` or `mouseleave` event
     * @param event the default mouse event object
     */
    function onMatchHover(event) {
        const elem = event?.target;
        elem?.classList?.toggle('hover');
    }
}
export default `(${onDocumentReady.toString()})(${ready.toString()})`;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib25lLXRvLW1hbnktaWZyYW1lLWxvZ2ljLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGxhZ2lhcmlzbS1yZXBvcnQvc3JjL2xpYi9wbGFnaWFyaXNtLXJlcG9ydC9jb21wb25lbnRzL2h0bWwtaGVscGVycy9vbmUtdG8tbWFueS1pZnJhbWUtbG9naWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0E7OztHQUdHO0FBQ0gsU0FBUyxlQUFlLENBQUMsRUFBTztJQUMvQixJQUFJLFFBQVEsQ0FBQyxVQUFVLEtBQUssVUFBVSxJQUFJLFFBQVEsQ0FBQyxVQUFVLEtBQUssYUFBYSxFQUFFO1FBQ2hGLFVBQVUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDbEI7U0FBTTtRQUNOLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRSxFQUFFLENBQUMsQ0FBQztLQUNsRDtBQUNGLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQVMsS0FBSztJQUNiLElBQUksT0FBd0IsQ0FBQztJQUM3QixJQUFJLE9BQTBCLENBQUM7SUFDL0IsSUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyw0QkFBNEIsQ0FBQyxLQUFLLElBQUksQ0FBQztJQUN6RSxNQUFjLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLG1CQUFtQixDQUFDLENBQUM7SUFDakUsSUFBSSxFQUFFLENBQUM7SUFFUDs7T0FFRztJQUNILFNBQVMsSUFBSTtRQUNaLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUN0QyxDQUFDLENBQUMsSUFBSSxHQUFHLG9CQUFvQixDQUFDO1lBQzlCLENBQUMsQ0FBQyxLQUFLLEdBQUcsY0FBYyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCO1FBQ3BCLE9BQU8sR0FBRyxLQUFL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akUsYUFBYSxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUVEOzs7T0FHRztJQUNILFNBQVMsWUFBWSxDQUFDLEtBQWlCO1FBQ3RDLE1BQU0sSUFBSSxHQUFHLEtBQUssRUFBRSxNQUF5QixDQUFDO1FBQzlDLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2xDLENBQUM7QUFDRixDQUFDO0FBRUQsZUFBZSxJQUFJLGVBQWUsQ0FBQyxRQUFRLEVBQUUsS0FBSyxLQUFLLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIHRzbGludDpkaXNhYmxlICovXG5pbXBvcnQgeyBNYXRjaEp1bXBFdmVudCwgTWF0Y2hTZWxlY3RFdmVudCwgUG9zdE1lc3NhZ2VFdmVudCB9IGZyb20gJy4uLy4uL21vZGVscyc7XG5cbi8qKlxuICogZG9jdW1lbnQgcmVhZHkgZXZlbnQgaGFuZGxlclxuICogQHBhcmFtIGZuIHRoZSBjYWxsYmFjayB0byBleGVjdXRlIHdoZW4gdGhlIGRvY3VtZW50IGlzIHJlYWR5XG4gKi9cbmZ1bmN0aW9uIG9uRG9jdW1lbnRSZWFkeShmbjogYW55KSB7XG5cdGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnIHx8IGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdpbnRlcmFjdGl2ZScpIHtcblx0XHRzZXRUaW1lb3V0KGZuLCAxKTtcblx0fSBlbHNlIHtcblx0XHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZm4pO1xuXHR9XG59XG5cbi8qKlxuICogQ2FsbGJhY2sgdG8gZXhlY3V0ZSB3aGVuIHRoZSBkb2N1bWVudCBpcyByZWFkeVxuICovXG5mdW5jdGlvbiByZWFkeSgpIHtcblx0bGV0IGN1cnJlbnQ6IEhUTUxTcGFuRWxlbWVudDtcblx0bGV0IG1hdGNoZXM6IEhUTUxTcGFuRWxlbWVudFtdO1xuXHRsZXQgaXNQZGYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtZXRhW2NvbnRlbnQ9XCJwZGYyaHRtbEVYXCJdJykgIT09IG51bGw7XG5cdCh3aW5kb3cgYXMgYW55KS5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgb25NZXNzYWdlRnJvbVBhcmVudCk7XG5cdGluaXQoKTtcblxuXHQvKipcblx0ICogSW5pdGlhbGl6YXRpb24gY29kZSwgd2lsbCBleGVjdXRlIGJlZm9yZSBlbWl0dGluZyBpZnJhbWUtcmVhZHkgZXZlbnRcblx0ICovXG5cdGZ1bmN0aW9uIGluaXQoKSB7XG5cdFx0QXJyYXkuZnJvbShkb2N1bWVudC5saW5rcykuZm9yRWFjaCh4ID0+IHtcblx0XHRcdHguaHJlZiA9ICdqYXZhc2NyaXB0OnZvaWQoMCknO1xuXHRcdFx0eC50aXRsZSA9ICdkaXNhYmxlIGxpbmsnO1xuXHRcdH0pOyAvLyBkaXNhYmxlIGxpbmtzXG5cdFx0bWF0Y2hlcyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnc3BhblttYXRjaF0nKSk7XG5cdFx0bWF0Y2hlcy5mb3JFYWNoKGVsZW0gPT4ge1xuXHRcdFx0ZWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTWF0Y2hDbGljayk7XG5cdFx0XHRlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCBvbk1hdGNoSG92ZXIpO1xuXHRcdFx0ZWxlbS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgb25NYXRjaEhvdmVyKTtcblx0XHR9KTtcblxuXHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3NwYW5bZXhjbHVkZS1wYXJ0aWFsLXNjYW5dJykuZm9yRWFjaChlbGVtID0+IHtcblx0XHRcdGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBtZXNzYWdlUGFyZW50KHsgdHlwZTogJ3VwZ3JhZGUtcGxhbicgfSkpO1xuXHRcdFx0ZWxlbS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgb25NYXRjaEhvdmVyKTtcblx0XHRcdGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIG9uTWF0Y2hIb3Zlcik7XG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogTWVzc2FnZSBldmVudCBoYW5kbGVyXG5cdCAqL1xuXHRmdW5jdGlvbiBvbk1lc3NhZ2VGcm9tUGFyZW50KG5hdGl2ZUV2ZW50KSB7XG5cdFx0aWYgKG5hdGl2ZUV2ZW50LnNvdXJjZSAhPT0gKHdpbmRvdyBhcyBhbnkpLnBhcmVudCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRjb25zdCBldmVudCA9IG5hdGl2ZUV2ZW50LmRhdGEgYXMgUG9zdE1lc3NhZ2VFdmVudDtcblx0XHRzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcblx0XHRcdGNhc2UgJ21hdGNoLXNlbGVjdCc6XG5cdFx0XHRcdGhhbmRsZUJyb2FkY2FzdE1hdGNoU2VsZWN0KGV2ZW50KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdtYXRjaC1qdW1wJzpcblx0XHRcdFx0b25NYXRjaEp1bXAoZXZlbnQpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoJ3Vua25vd24gZXZlbnQgaW4gZnJhbWUnLCBuYXRpdmVFdmVudCk7XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIGhhbmRsZSBhIGJyb2FkY2FzdGVkIGBtYXRjaC1zZWxlY3RgIGV2ZW50XG5cdCAqIEBwYXJhbSBldmVudCB0aGUgbWF0Y2ggc2VsZWN0IGV2ZW50XG5cdCAqL1xuXHRmdW5jdGlvbiBoYW5kbGVCcm9hZGNhc3RNYXRjaFNlbGVjdChldmVudDogTWF0Y2hTZWxlY3RFdmVudCkge1xuXHRcdGNvbnN0IGVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxTcGFuRWxlbWVudD4oYHNwYW5bbWF0Y2hdW2RhdGEtaW5kZXg9JyR7ZXZlbnQuaW5kZXh9J11gKTtcblx0XHRpZiAoIWVsZW0gJiYgZXZlbnQuaW5kZXggIT09IC0xKSB7XG5cdFx0XHRtZXNzYWdlUGFyZW50KHsgdHlwZTogJ21hdGNoLXdhcm4nIH0pO1xuXHRcdH1cblx0XHRvbk1hdGNoU2VsZWN0KGVsZW0sIHRydWUpOyAvLyBzaG91bGQgbm90IHJlYnJvYWRjYXN0XG5cdH1cblxuXHQvKipcblx0ICogRXZlbnQgaGFuZGxlciBmb3IgYSBgTWF0Y2hKdW1wRXZlbnRgIHRoYXQgaXMgZmlyZWQgd2hlbiB0aGUgdXNlciBjbGlja3MgdGhlXG5cdCAqIGdvIHRvIG5leHQvcHJldiBtYXRjaCBidXR0b25zXG5cdCAqL1xuXHRmdW5jdGlvbiBvbk1hdGNoSnVtcChldmVudDogTWF0Y2hKdW1wRXZlbnQpIHtcblx0XHRpZiAoIWN1cnJlbnQpIHtcblx0XHRcdG9uTWF0Y2hTZWxlY3QobWF0Y2hlc1swXSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdGNvbnN0IGZpcnN0ID0gbWF0Y2hlc1swXTtcblx0XHRjb25zdCBsYXN0ID0gbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdO1xuXHRcdGlmICgoY3VycmVudCA9PT0gZmlyc3QgJiYgIWV2ZW50LmZvcndhcmQpIHx8IChjdXJyZW50ID09PSBsYXN0ICYmIGV2ZW50LmZvcndhcmQpKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y29uc3QgY3VycmVudEluZGV4ID0gbWF0Y2hlcy5pbmRleE9mKGN1cnJlbnQpO1xuXHRcdGNvbnN0IG5leHRJbmRleCA9IGN1cnJlbnRJbmRleCArIChldmVudC5mb3J3YXJkID8gMSA6IC0xKTtcblxuXHRcdG9uTWF0Y2hTZWxlY3QobWF0Y2hlc1tuZXh0SW5kZXhdKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBFbWl0cyBhbiBldmVudCB0byB0aGUgcGFyZW50IHdpbmRvdyB1c2luZyBQb3N0TWVzc2FnZSBBUElcblx0ICogQHBhcmFtIGV2ZW50IHRoZSBldmVudCBjb250ZW50IHRvIGVtaXRcblx0ICovXG5cdGZ1bmN0aW9uIG1lc3NhZ2VQYXJlbnQoZXZlbnQ6IFBvc3RNZXNzYWdlRXZlbnQpIHtcblx0XHQod2luZG93IGFzIGFueSkucGFyZW50LnBvc3RNZXNzYWdlKGV2ZW50LCAnKicpO1xuXHR9XG5cblx0LyoqXG5cdCAqIEV2ZW50IGhhbmRsZXIgZm9yIHRoZSBkZWZhdWx0IGNsaWNrIGV2ZW50IG9mIGEgbWF0Y2hcblx0ICogQHBhcmFtIGV2ZW50IHRoZSBkZWZhdWx0IG1vdXNlIGV2ZW50IG9iamVjdFxuXHQgKi9cblx0ZnVuY3Rpb24gb25NYXRjaENsaWNrKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG5cdFx0Y29uc3QgZWxlbSA9IGV2ZW50LnRhcmdldCBhcyBIVE1MU3BhbkVsZW1lbnQ7XG5cdFx0b25NYXRjaFNlbGVjdChlbGVtKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBFeGVjdXRlIHRoZSBsb2dpYyBvZiBhIG1hdGNoIHNlbGVjdGlvbi5cblx0ICogLSBoaWdobGlnaHQgYGVsZW1gIGFuZCBtZXNzYWdlIHRoZSBwYXJlbnQgd2luZG93IGFib3V0IGl0XG5cdCAqIC0gaWYgYW4gZWxlbWVudCBpcyBhbGxyZWFkeSBoaWdobGlnaHRlZCB0dXJuIGl0IG9mZiBhbmQgaGlnaGxpZ2h0IGBlbGVtYFxuXHQgKiBAcGFyYW0gZWxlbSB0aGUgc2VsZWN0ZWQgZWxlbWVudFxuXHQgKi9cblx0ZnVuY3Rpb24gb25NYXRjaFNlbGVjdChlbGVtOiBIVE1MU3BhbkVsZW1lbnQsIGJyb2FkY2FzdDogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XG5cdFx0aWYgKCFicm9hZGNhc3QgJiYgY3VycmVudCA9PT0gZWxlbSkge1xuXHRcdFx0Y3VycmVudC50b2dnbGVBdHRyaWJ1dGUoJ29uJywgZmFsc2UpO1xuXHRcdFx0Y3VycmVudCA9IG51bGw7XG5cdFx0XHRtZXNzYWdlUGFyZW50KHsgdHlwZTogJ21hdGNoLXNlbGVjdCcsIGluZGV4OiAtMSB9KTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0aWYgKCFicm9hZGNhc3QgJiYgY3VycmVudCkge1xuXHRcdFx0Y3VycmVudC50b2dnbGVBdHRyaWJ1dGUoJ29uJywgZmFsc2UpO1xuXHRcdH1cblx0XHRjdXJyZW50ID0gZWxlbTtcblx0XHRjdXJyZW50LnRvZ2dsZUF0dHJpYnV0ZSgnb24nLCB0cnVlKTtcblx0XHRpZiAoaXNQZGYpIHtcblx0XHRcdGVsZW0uY2xvc2VzdCgnLnBjJykuY2xhc3NMaXN0LmFkZCgnb3BlbmVkJyk7XG5cdFx0fVxuXHRcdGN1cnJlbnQuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhdmlvcjogJ3Ntb290aCcsIGJsb2NrOiAnbmVhcmVzdCcgfSk7XG5cdFx0bWVzc2FnZVBhcmVudCh7IHR5cGU6ICdtYXRjaC1zZWxlY3QnLCBpbmRleDogK2N1cnJlbnQuZGF0YXNldC5pbmRleCB9KTtcblx0fVxuXG5cdC8qKlxuXHQgKiBFdmVudCBoYW5kbGVyIGZvciB0aGUgZGVmYXVsdCBgbW91c2VlbnRlcmAgb3IgYG1vdXNlbGVhdmVgIGV2ZW50XG5cdCAqIEBwYXJhbSBldmVudCB0aGUgZGVmYXVsdCBtb3VzZSBldmVudCBvYmplY3Rcblx0ICovXG5cdGZ1bmN0aW9uIG9uTWF0Y2hIb3ZlcihldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xuXHRcdGNvbnN0IGVsZW0gPSBldmVudD8udGFyZ2V0IGFzIEhUTUxTcGFuRWxlbWVudDtcblx0XHRlbGVtPy5jbGFzc0xpc3Q/LnRvZ2dsZSgnaG92ZXInKTtcblx0fVxufVxuXG5leHBvcnQgZGVmYXVsdCBgKCR7b25Eb2N1bWVudFJlYWR5LnRvU3RyaW5nKCl9KSgke3JlYWR5LnRvU3RyaW5nKCl9KWA7XG4iXX0=