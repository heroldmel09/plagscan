import { Component } from '@angular/core';
import { combineLatest } from 'rxjs';
import { distinctUntilChanged, filter, map } from 'rxjs/operators';
import { untilDestroy } from '../../../shared/operators/untilDestroy';
import { truthy } from '../../utils/operators';
import { HtmlHelperBase } from './HtmlHelperBase';
import iframeScript from './one-to-many-iframe-logic';
import deepEqual from 'deep-equal';
import * as i0 from "@angular/core";
import * as i1 from "../../services/highlight.service";
import * as i2 from "../../services/match.service";
import * as i3 from "../../services/report.service";
import * as i4 from "../../services/copyleaks-translate.service";
/**
 * Component to handle manipulating the scan result's html inside an iframe
 */
export class OriginalHtmlHelperComponent extends HtmlHelperBase {
    constructor(renderer, element, highlightService, matchService, reportService, translateService) {
        super(renderer, element, reportService, translateService);
        this.highlightService = highlightService;
        this.matchService = matchService;
        this.renderedSuccessfully = false;
        const js = renderer.createElement('script');
        js.textContent = iframeScript;
        this.script = js.outerHTML;
    }
    /**
     * handle match selection
     */
    handleMatchSelect(event) {
        this.lastMatchSelectEvent = event;
        this.highlightService.setOriginalHtmlMatch(event.index !== -1 ? this.matches[event.index] : null);
    }
    /**
     * Life-cycle method
     * subscribe to:
     * - original html matches
     * - view mode changes
     * - source ducument
     * - jump events
     */
    ngOnInit() {
        const { source$, viewMode$, contentMode$ } = this.reportService;
        const { jump$ } = this.highlightService;
        const { originalHtmlMatches$ } = this.matchService;
        source$
            .pipe(truthy(), filter(source => !!source.html))
            .subscribe(source => {
            this.html = source.html.value;
            this.setHtml(this.html);
        });
        combineLatest([source$.pipe(truthy()), originalHtmlMatches$])
            .pipe(untilDestroy(this))
            .subscribe(([, matches]) => {
            if (!this.renderedSuccessfully || !deepEqual(this.matches, matches)) {
                this.matches = matches;
                this.renderMatches(matches);
                this.renderedSuccessfully = true;
                this.lastMatchSelectEvent = null;
            }
            if (this.lastMatchSelectEvent && this.lastMatchSelectEvent.index !== -1) {
                this.messageFrame({ type: 'match-select', index: this.lastMatchSelectEvent?.index });
            }
        });
        const onOneToManyHtmlJump$ = combineLatest([jump$, contentMode$, viewMode$]).pipe(distinctUntilChanged(), untilDestroy(this), filter(([forward, content, viewMode]) => (forward === true || forward === false) && viewMode === 'one-to-many' && content === 'html'), map(([forward]) => forward));
        onOneToManyHtmlJump$.subscribe(forward => {
            this.messageFrame({ type: 'match-jump', forward });
        });
    }
    /**
     * Life-cycle method
     * empty for `untilDestroy` rxjs operator
     */
    ngOnDestroy() { }
}
OriginalHtmlHelperComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.3", ngImport: i0, type: OriginalHtmlHelperComponent, deps: [{ token: i0.Renderer2 }, { token: i0.ElementRef }, { token: i1.HighlightService }, { token: i2.MatchService }, { token: i3.ReportService }, { token: i4.CopyleaksTranslateService }], target: i0.ɵɵFactoryTarget.Component });
OriginalHtmlHelperComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.3", type: OriginalHtmlHelperComponent, selector: "iframe[cr-original-html-helper]", usesInheritance: true, ngImport: i0, template: '', isInline: true, styles: ["#sidebar.opened+#page-container{left:0px!important}#page-container .c{pointer-events:none!important}#page-container .t{pointer-events:all!important}span[exclude]{font-style:italic;opacity:.75}span[exclude-partial-scan]{filter:blur(6px);cursor:pointer}span[match]{cursor:pointer;color:#000}span[match] a:link{pointer-events:none}span[ignored]{font-style:italic}span[match][data-type=\"0\"]{background-color:#f66}span[match][data-type=\"0\"].hover{background-color:#ff8080}span[match][data-type=\"1\"]{background-color:#ff9a9a}span[match][data-type=\"1\"].hover{background-color:#ffb4b4}span[match][data-type=\"2\"]{background-color:#ffd9b0}span[match][data-type=\"2\"].hover{background-color:#ffe5ca}span[match][on]{background-color:gold!important}\n"] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.3", ngImport: i0, type: OriginalHtmlHelperComponent, decorators: [{
            type: Component,
            args: [{ selector: 'iframe[cr-original-html-helper]', template: '', styles: ["#sidebar.opened+#page-container{left:0px!important}#page-container .c{pointer-events:none!important}#page-container .t{pointer-events:all!important}span[exclude]{font-style:italic;opacity:.75}span[exclude-partial-scan]{filter:blur(6px);cursor:pointer}span[match]{cursor:pointer;color:#000}span[match] a:link{pointer-events:none}span[ignored]{font-style:italic}span[match][data-type=\"0\"]{background-color:#f66}span[match][data-type=\"0\"].hover{background-color:#ff8080}span[match][data-type=\"1\"]{background-color:#ff9a9a}span[match][data-type=\"1\"].hover{background-color:#ffb4b4}span[match][data-type=\"2\"]{background-color:#ffd9b0}span[match][data-type=\"2\"].hover{background-color:#ffe5ca}span[match][on]{background-color:gold!important}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.Renderer2 }, { type: i0.ElementRef }, { type: i1.HighlightService }, { type: i2.MatchService }, { type: i3.ReportService }, { type: i4.CopyleaksTranslateService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JpZ2luYWwtaHRtbC1oZWxwZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGxhZ2lhcmlzbS1yZXBvcnQvc3JjL2xpYi9wbGFnaWFyaXNtLXJlcG9ydC9jb21wb25lbnRzL2h0bWwtaGVscGVycy9vcmlnaW5hbC1odG1sLWhlbHBlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBNEMsTUFBTSxlQUFlLENBQUM7QUFDcEYsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNyQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUt0RSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDL0MsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sWUFBWSxNQUFNLDRCQUE0QixDQUFDO0FBRXRELE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQzs7Ozs7O0FBRW5DOztHQUVHO0FBTUgsTUFBTSxPQUFPLDJCQUE0QixTQUFRLGNBQWM7SUFHOUQsWUFDQyxRQUFtQixFQUNuQixPQUFzQyxFQUM5QixnQkFBa0MsRUFDbEMsWUFBMEIsRUFDbEMsYUFBNEIsRUFDNUIsZ0JBQTJDO1FBRTNDLEtBQUssQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBTGxELHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsaUJBQVksR0FBWixZQUFZLENBQWM7UUFMM0IseUJBQW9CLEdBQUcsS0FBSyxDQUFDO1FBVXBDLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMs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QUFDO1FBQ0Ysb0JBQW9CLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3hDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBb0IsQ0FBQyxDQUFDO1FBQ3RFLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7T0FHRztJQUNILFdBQVcsS0FBSSxDQUFDOzt3SEEvRUosMkJBQTJCOzRHQUEzQiwyQkFBMkIsOEZBSDdCLEVBQUU7MkZBR0EsMkJBQTJCO2tCQUx2QyxTQUFTOytCQUNDLGlDQUFpQyxZQUNqQyxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBPbkRlc3Ryb3ksIE9uSW5pdCwgUmVuZGVyZXIyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsQ2hhbmdlZCwgZmlsdGVyLCBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyB1bnRpbERlc3Ryb3kgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvb3BlcmF0b3JzL3VudGlsRGVzdHJveSc7XG5pbXBvcnQgeyBNYXRjaEp1bXBFdmVudCwgTWF0Y2hTZWxlY3RFdmVudCB9IGZyb20gJy4uLy4uL21vZGVscyc7XG5pbXBvcnQgeyBIaWdobGlnaHRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvaGlnaGxpZ2h0LnNlcnZpY2UnO1xuaW1wb3J0IHsgTWF0Y2hTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvbWF0Y2guc2VydmljZSc7XG5pbXBvcnQgeyBSZXBvcnRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvcmVwb3J0LnNlcnZpY2UnO1xuaW1wb3J0IHsgdHJ1dGh5IH0gZnJvbSAnLi4vLi4vdXRpbHMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEh0bWxIZWxwZXJCYXNlIH0gZnJvbSAnLi9IdG1sSGVscGVyQmFzZSc7XG5pbXBvcnQgaWZyYW1lU2NyaXB0IGZyb20gJy4vb25lLXRvLW1hbnktaWZyYW1lLWxvZ2ljJztcbmltcG9ydCB7IENvcHlsZWFrc1RyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jb3B5bGVha3MtdHJhbnNsYXRlLnNlcnZpY2UnO1xuaW1wb3J0IGRlZXBFcXVhbCBmcm9tICdkZWVwLWVxdWFsJztcblxuLyoqXG4gKiBDb21wb25lbnQgdG8gaGFuZGxlIG1hbmlwdWxhdGluZyB0aGUgc2NhbiByZXN1bHQncyBodG1sIGluc2lkZSBhbiBpZnJhbWVcbiAqL1xuQENvbXBvbmVudCh7XG5cdHNlbGVjdG9yOiAnaWZyYW1lW2NyLW9yaWdpbmFsLWh0bWwtaGVscGVyXScsXG5cdHRlbXBsYXRlOiAnJyxcblx0c3R5bGVVcmxzOiBbJy4vaHRtbC1oZWxwZXIuc2NzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBPcmlnaW5hbEh0bWxIZWxwZXJDb21wb25lbnQgZXh0ZW5kcyBIdG1sSGVscGVyQmFzZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblx0cHJpdmF0ZSBsYXN0TWF0Y2hTZWxlY3RFdmVudDogTWF0Y2hTZWxlY3RFdmVudDtcblx0cHJpdmF0ZSByZW5kZXJlZFN1Y2Nlc3NmdWxseSA9IGZhbHNlO1xuXHRjb25zdHJ1Y3Rvcihcblx0XHRyZW5kZXJlcjogUmVuZGVyZXIyLFxuXHRcdGVsZW1lbnQ6IEVsZW1lbnRSZWY8SFRNTElGcmFtZUVsZW1lbnQ+LFxuXHRcdHByaXZhdGUgaGlnaGxpZ2h0U2VydmljZTogSGlnaGxpZ2h0U2VydmljZSxcblx0XHRwcml2YXRlIG1hdGNoU2VydmljZTogTWF0Y2hTZXJ2aWNlLFxuXHRcdHJlcG9ydFNlcnZpY2U6IFJlcG9ydFNlcnZpY2UsXG5cdFx0dHJhbnNsYXRlU2VydmljZTogQ29weWxlYWtzVHJhbnNsYXRlU2VydmljZVxuXHQpIHtcblx0XHRzdXBlcihyZW5kZXJlciwgZWxlbWVudCwgcmVwb3J0U2VydmljZSwgdHJhbnNsYXRlU2VydmljZSk7XG5cdFx0Y29uc3QganMgPSByZW5kZXJlci5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKSBhcyBIVE1MU2NyaXB0RWxlbWVudDtcblx0XHRqcy50ZXh0Q29udGVudCA9IGlmcmFtZVNjcmlwdDtcblx0XHR0aGlzLnNjcmlwdCA9IGpzLm91dGVySFRNTDtcblx0fVxuXG5cdC8qKlxuXHQgKiBoYW5kbGUgbWF0Y2ggc2VsZWN0aW9uXG5cdCAqL1xuXHRoYW5kbGVNYXRjaFNlbGVjdChldmVudDogTWF0Y2hTZWxlY3RFdmVudCkge1xuXHRcdHRoaXMubGFzdE1hdGNoU2VsZWN0RXZlbnQgPSBldmVudDtcblx0XHR0aGlzLmhpZ2hsaWdodFNlcnZpY2Uuc2V0T3JpZ2luYWxIdG1sTWF0Y2goZXZlbnQuaW5kZXggIT09IC0xID8gdGhpcy5tYXRjaGVzW2V2ZW50LmluZGV4XSA6IG51bGwpO1xuXHR9XG5cblx0LyoqXG5cdCAqIExpZmUtY3ljbGUgbWV0aG9kXG5cdCAqIHN1YnNjcmliZSB0bzpcblx0ICogLSBvcmlnaW5hbCBodG1sIG1hdGNoZXNcblx0ICogLSB2aWV3IG1vZGUgY2hhbmdlc1xuXHQgKiAtIHNvdXJjZSBkdWN1bWVudFxuXHQgKiAtIGp1bXAgZXZlbnRzXG5cdCAqL1xuXHRuZ09uSW5pdCgpIHtcblx0XHRjb25zdCB7IHNvdXJjZSQsIHZpZXdNb2RlJCwgY29udGVudE1vZGUkIH0gPSB0aGlzLnJlcG9ydFNlcnZpY2U7XG5cdFx0Y29uc3QgeyBqdW1wJCB9ID0gdGhpcy5oaWdobGlnaHRTZXJ2aWNlO1xuXHRcdGNvbnN0IHsgb3JpZ2luYWxIdG1sTWF0Y2hlcyQgfSA9IHRoaXMubWF0Y2hTZXJ2aWNlO1xuXHRcdHNvdXJjZSRcblx0XHRcdC5waXBlKFxuXHRcdFx0XHR0cnV0aHkoKSxcblx0XHRcdFx0ZmlsdGVyKHNvdXJjZSA9PiAhIXNvdXJjZS5odG1sKVxuXHRcdFx0KVxuXHRcdFx0LnN1YnNjcmliZShzb3VyY2UgPT4ge1xuXHRcdFx0XHR0aGlzLmh0bWwgPSBzb3VyY2UuaHRtbC52YWx1ZTtcblx0XHRcdFx0dGhpcy5zZXRIdG1sKHRoaXMuaHRtbCk7XG5cdFx0XHR9KTtcblx0XHRjb21iaW5lTGF0ZXN0KFtzb3VyY2UkLnBpcGUodHJ1dGh5KCkpLCBvcmlnaW5hbEh0bWxNYXRjaGVzJF0pXG5cdFx0XHQucGlwZSh1bnRpbERlc3Ryb3kodGhpcykpXG5cdFx0XHQuc3Vic2NyaWJlKChbLCBtYXRjaGVzXSkgPT4ge1xuXHRcdFx0XHRpZiAoIXRoaXMucmVuZGVyZWRTdWNjZXNzZnVsbHkgfHwgIWRlZXBFcXVhbCh0aGlzLm1hdGNoZXMsIG1hdGNoZXMpKSB7XG5cdFx0XHRcdFx0dGhpcy5tYXRjaGVzID0gbWF0Y2hlcztcblx0XHRcdFx0XHR0aGlzLnJlbmRlck1hdGNoZXMobWF0Y2hlcyk7XG5cdFx0XHRcdFx0dGhpcy5yZW5kZXJlZFN1Y2Nlc3NmdWxseSA9IHRydWU7XG5cdFx0XHRcdFx0dGhpcy5sYXN0TWF0Y2hTZWxlY3RFdmVudCA9IG51bGw7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodGhpcy5sYXN0TWF0Y2hTZWxlY3RFdmVudCAmJiB0aGlzLmxhc3RNYXRjaFNlbGVjdEV2ZW50LmluZGV4ICE9PSAtMSkge1xuXHRcdFx0XHRcdHRoaXMubWVzc2FnZUZyYW1lKHsgdHlwZTogJ21hdGNoLXNlbGVjdCcsIGluZGV4OiB0aGlzLmxhc3RNYXRjaFNlbGVjdEV2ZW50Py5pbmRleCB9IGFzIE1hdGNoU2VsZWN0RXZlbnQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdGNvbnN0IG9uT25lVG9NYW55SHRtbEp1bXAkID0gY29tYmluZUxhdGVzdChbanVtcCQsIGNvbnRlbnRNb2RlJCwgdmlld01vZGUkXSkucGlwZShcblx0XHRcdGRpc3RpbmN0VW50aWxDaGFuZ2VkKCksXG5cdFx0XHR1bnRpbERlc3Ryb3kodGhpcyksXG5cdFx0XHRmaWx0ZXIoXG5cdFx0XHRcdChbZm9yd2FyZCwgY29udGVudCwgdmlld01vZGVdKSA9PlxuXHRcdFx0XHRcdChmb3J3YXJkID09PSB0cnVlIHx8IGZvcndhcmQgPT09IGZhbHNlKSAmJiB2aWV3TW9kZSA9PT0gJ29uZS10by1tYW55JyAmJiBjb250ZW50ID09PSAnaHRtbCdcblx0XHRcdCksXG5cdFx0XHRtYXAoKFtmb3J3YXJkXSkgPT4gZm9yd2FyZClcblx0XHQpO1xuXHRcdG9uT25lVG9NYW55SHRtbEp1bXAkLnN1YnNjcmliZShmb3J3YXJkID0+IHtcblx0XHRcdHRoaXMubWVzc2FnZUZyYW1lKHsgdHlwZTogJ21hdGNoLWp1bXAnLCBmb3J3YXJkIH0gYXMgTWF0Y2hKdW1wRXZlbnQpO1xuXHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIExpZmUtY3ljbGUgbWV0aG9kXG5cdCAqIGVtcHR5IGZvciBgdW50aWxEZXN0cm95YCByeGpzIG9wZXJhdG9yXG5cdCAqL1xuXHRuZ09uRGVzdHJveSgpIHt9XG59XG4iXX0=