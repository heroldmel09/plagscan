import { MatchType } from '../models';
/**
 * Find the respective match for a given match directive element containing a match object
 * If the match is from the source, the return value will contain the source index first, and
 * then the suspect's index, and vice versa.
 * @param match the match directive element
 * @param result the suspect currently viewed
 * @param isSource whether the match comes from the source
 * @returns pair of indices.
 */
export const findRespectiveMatch = (match, comparisons, isSource = true) => {
    const { type, start } = match;
    const { source: original, suspected: suspect } = comparisons[MatchType[type]];
    const [source, target] = isSource ? [original, suspect] : [suspect, original];
    const index = source.chars.starts.findIndex((s, i) => s <= start && start <= s + source.chars.lengths[i]);
    return [source.chars.starts[index], target.chars.starts[index]];
};
/**
 * Calculates the page number of where the start position should be
 * @param start the start position
 * @param pages array of start positions
 */
export const findRespectivePage = (start, pages) => {
    let page;
    for (page = 1; page < pages.length; page++) {
        if (start < pages[page]) {
            break;
        }
    }
    return page;
};
/**
 * Search source for a match containing the given match's start position and return that match's start position
 * @param start the match to look for
 * @param source the scan source object.
 */
export const findPartialMatch = (match, suspect) => {
    const { start, end } = match;
    const { identical, minorChanges, relatedMeaning } = suspect;
    for (const comparison of [identical, minorChanges, relatedMeaning]) {
        if (!comparison) {
            continue;
        }
        const { source } = comparison;
        const found = source.chars.starts.find((s, i) => s <= start && end <= s + source.chars.lengths[i]);
        if (found !== undefined) {
            return found;
        }
    }
};
/**
 * Locate the index of the next page that contains some match
 * @param matches the matches to look up in
 * @param current the index of the current page
 */
export const findNextPageWithMatch = (matches, current) => {
    for (let i = current; i < matches.length; i++) {
        if (matches[i].some(({ match }) => match.type !== MatchType.none && match.type !== MatchType.excluded)) {
            return i + 1;
        }
    }
    return current;
};
/**
 * Locate the index of the previouse page that contains some match
 * @param matches the current active matches
 * @param current the index of the current match
 */
export const findPrevPageWithMatch = (matches, current) => {
    for (let i = current - 2; i >= 0; i--) {
        if (matches[i].some(match => match.match.type !== MatchType.none)) {
            return i + 1;
        }
    }
    return current;
};
/**
 * Mark/Unmark the next match component based on the previously marked component
 * @param prev the previously marked/unmarked match
 * @param next the match to mark/unmark next
 * @returns `true` if the match is eventualy highlighted
 */
export const onTextMatchChange = ([prev, next]) => {
    if (next) {
        if (prev && prev !== next) {
            prev.focused = false;
        }
        next.focused = !next.focused;
    }
    else {
        if (prev) {
            prev.focused = false;
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlnaGxpZ2h0LWhlbHBlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9wbGFnaWFyaXNtLXJlcG9ydC9zcmMvbGliL3BsYWdpYXJpc20tcmVwb3J0L3V0aWxzL2hpZ2hsaWdodC1oZWxwZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBZSxTQUFTLEVBQTJDLE1BQU0sV0FBVyxDQUFDO0FBRzVGOzs7Ozs7OztHQVFHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sbUJBQW1CLEdBQUcsQ0FDbEMsS0FBWSxFQUNaLFdBQWlDLEVBQ2pDLFFBQVEsR0FBRyxJQUFJLEVBQ0ksRUFBRTtJQUNyQixNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLEtBQUssQ0FBQztJQUM5QixNQUFNLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBZSxDQUFDO0lBQzVGLE1BQU0sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDOUUsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLEtBQUssSUFBSSxLQUFLLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDMUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtB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SUFBSSxFQUFFO1lBQzFCLElBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO1NBQ3JCO1FBQ0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7S0FDN0I7U0FBTTtRQUNOLElBQUksSUFBSSxFQUFFO1lBQ1QsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7U0FDckI7S0FDRDtBQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNsaWNlZE1hdGNoLCBNYXRjaFR5cGUsIENvbXBhcmlzb25Db2xsZWN0aW9uLCBNYXRjaCwgQ29tcGFyaXNvbiB9IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBNYXRjaENvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudHMvbWF0Y2gvbWF0Y2guY29tcG9uZW50JztcblxuLyoqXG4gKiBGaW5kIHRoZSByZXNwZWN0aXZlIG1hdGNoIGZvciBhIGdpdmVuIG1hdGNoIGRpcmVjdGl2ZSBlbGVtZW50IGNvbnRhaW5pbmcgYSBtYXRjaCBvYmplY3RcbiAqIElmIHRoZSBtYXRjaCBpcyBmcm9tIHRoZSBzb3VyY2UsIHRoZSByZXR1cm4gdmFsdWUgd2lsbCBjb250YWluIHRoZSBzb3VyY2UgaW5kZXggZmlyc3QsIGFuZFxuICogdGhlbiB0aGUgc3VzcGVjdCdzIGluZGV4LCBhbmQgdmljZSB2ZXJzYS5cbiAqIEBwYXJhbSBtYXRjaCB0aGUgbWF0Y2ggZGlyZWN0aXZlIGVsZW1lbnRcbiAqIEBwYXJhbSByZXN1bHQgdGhlIHN1c3BlY3QgY3VycmVudGx5IHZpZXdlZFxuICogQHBhcmFtIGlzU291cmNlIHdoZXRoZXIgdGhlIG1hdGNoIGNvbWVzIGZyb20gdGhlIHNvdXJjZVxuICogQHJldHVybnMgcGFpciBvZiBpbmRpY2VzLlxuICovXG5leHBvcnQgY29uc3QgZmluZFJlc3BlY3RpdmVNYXRjaCA9IChcblx0bWF0Y2g6IE1hdGNoLFxuXHRjb21wYXJpc29uczogQ29tcGFyaXNvbkNvbGxlY3Rpb24sXG5cdGlzU291cmNlID0gdHJ1ZVxuKTogW251bWJlciwgbnVtYmVyXSA9PiB7XG5cdGNvbnN0IHsgdHlwZSwgc3RhcnQgfSA9IG1hdGNoO1xuXHRjb25zdCB7IHNvdXJjZTogb3JpZ2luYWwsIHN1c3BlY3RlZDogc3VzcGVjdCB9ID0gY29tcGFyaXNvbnNbTWF0Y2hUeXBlW3R5cGVdXSBhcyBDb21wYXJpc29uO1xuXHRjb25zdCBbc291cmNlLCB0YXJnZXRdID0gaXNTb3VyY2UgPyBbb3JpZ2luYWwsIHN1c3BlY3RdIDogW3N1c3BlY3QsIG9yaWdpbmFsXTtcblx0Y29uc3QgaW5kZXggPSBzb3VyY2UuY2hhcnMuc3RhcnRzLmZpbmRJbmRleCgocywgaSkgPT4gcyA8PSBzdGFydCAmJiBzdGFydCA8PSBzICsgc291cmNlLmNoYXJzLmxlbmd0aHNbaV0pO1xuXHRyZXR1cm4gW3NvdXJjZS5jaGFycy5zdGFydHNbaW5kZXhdLCB0YXJnZXQuY2hhcnMuc3RhcnRzW2luZGV4XV07XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIHBhZ2UgbnVtYmVyIG9mIHdoZXJlIHRoZSBzdGFydCBwb3NpdGlvbiBzaG91bGQgYmVcbiAqIEBwYXJhbSBzdGFydCB0aGUgc3RhcnQgcG9zaXRpb25cbiAqIEBwYXJhbSBwYWdlcyBhcnJheSBvZiBzdGFydCBwb3NpdGlvbnNcbiAqL1xuZXhwb3J0IGNvbnN0IGZpbmRSZXNwZWN0aXZlUGFnZSA9IChzdGFydDogbnVtYmVyLCBwYWdlczogbnVtYmVyW10pOiBudW1iZXIgPT4ge1xuXHRsZXQgcGFnZTogbnVtYmVyO1xuXHRmb3IgKHBhZ2UgPSAxOyBwYWdlIDwgcGFnZXMubGVuZ3RoOyBwYWdlKyspIHtcblx0XHRpZiAoc3RhcnQgPCBwYWdlc1twYWdlXSkge1xuXHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9XG5cdHJldHVybiBwYWdlO1xufTtcblxuLyoqXG4gKiBTZWFyY2ggc291cmNlIGZvciBhIG1hdGNoIGNvbnRhaW5pbmcgdGhlIGdpdmVuIG1hdGNoJ3Mgc3RhcnQgcG9zaXRpb24gYW5kIHJldHVybiB0aGF0IG1hdGNoJ3Mgc3RhcnQgcG9zaXRpb25cbiAqIEBwYXJhbSBzdGFydCB0aGUgbWF0Y2ggdG8gbG9vayBmb3JcbiAqIEBwYXJhbSBzb3VyY2UgdGhlIHNjYW4gc291cmNlIG9iamVjdC5cbiAqL1xuZXhwb3J0IGNvbnN0IGZpbmRQYXJ0aWFsTWF0Y2ggPSAobWF0Y2g6IE1hdGNoLCBzdXNwZWN0OiBDb21wYXJpc29uQ29sbGVjdGlvbik6IG51bWJlciA9PiB7XG5cdGNvbnN0IHsgc3RhcnQsIGVuZCB9ID0gbWF0Y2g7XG5cdGNvbnN0IHsgaWRlbnRpY2FsLCBtaW5vckNoYW5nZXMsIHJlbGF0ZWRNZWFuaW5nIH0gPSBzdXNwZWN0O1xuXHRmb3IgKGNvbnN0IGNvbXBhcmlzb24gb2YgW2lkZW50aWNhbCwgbWlub3JDaGFuZ2VzLCByZWxhdGVkTWVhbmluZ10pIHtcblx0XHRpZiAoIWNvbXBhcmlzb24pIHtcblx0XHRcdGNvbnRpbnVlO1xuXHRcdH1cblx0XHRjb25zdCB7IHNvdXJjZSB9ID0gY29tcGFyaXNvbjtcblx0XHRjb25zdCBmb3VuZCA9IHNvdXJjZS5jaGFycy5zdGFydHMuZmluZCgocywgaSkgPT4gcyA8PSBzdGFydCAmJiBlbmQgPD0gcyArIHNvdXJjZS5jaGFycy5sZW5ndGhzW2ldKTtcblx0XHRpZiAoZm91bmQgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cmV0dXJuIGZvdW5kO1xuXHRcdH1cblx0fVxufTtcblxuLyoqXG4gKiBMb2NhdGUgdGhlIGluZGV4IG9mIHRoZSBuZXh0IHBhZ2UgdGhhdCBjb250YWlucyBzb21lIG1hdGNoXG4gKiBAcGFyYW0gbWF0Y2hlcyB0aGUgbWF0Y2hlcyB0byBsb29rIHVwIGluXG4gKiBAcGFyYW0gY3VycmVudCB0aGUgaW5kZXggb2YgdGhlIGN1cnJlbnQgcGFnZVxuICovXG5leHBvcnQgY29uc3QgZmluZE5leHRQYWdlV2l0aE1hdGNoID0gKG1hdGNoZXM6IFNsaWNlZE1hdGNoW11bXSwgY3VycmVudDogbnVtYmVyKTogbnVtYmVyID0+IHtcblx0Zm9yIChsZXQgaSA9IGN1cnJlbnQ7IGkgPCBtYXRjaGVzLmxlbmd0aDsgaSsrKSB7XG5cdFx0aWYgKG1hdGNoZXNbaV0uc29tZSgoeyBtYXRjaCB9KSA9PiBtYXRjaC50eXBlICE9PSBNYXRjaFR5cGUubm9uZSAmJiBtYXRjaC50eXBlICE9PSBNYXRjaFR5cGUuZXhjbHVkZWQpKSB7XG5cdFx0XHRyZXR1cm4gaSArIDE7XG5cdFx0fVxuXHR9XG5cdHJldHVybiBjdXJyZW50O1xufTtcblxuLyoqXG4gKiBMb2NhdGUgdGhlIGluZGV4IG9mIHRoZSBwcmV2aW91c2UgcGFnZSB0aGF0IGNvbnRhaW5zIHNvbWUgbWF0Y2hcbiAqIEBwYXJhbSBtYXRjaGVzIHRoZSBjdXJyZW50IGFjdGl2ZSBtYXRjaGVzXG4gKiBAcGFyYW0gY3VycmVudCB0aGUgaW5kZXggb2YgdGhlIGN1cnJlbnQgbWF0Y2hcbiAqL1xuZXhwb3J0IGNvbnN0IGZpbmRQcmV2UGFnZVdpdGhNYXRjaCA9IChtYXRjaGVzOiBTbGljZWRNYXRjaFtdW10sIGN1cnJlbnQ6IG51bWJlcik6IG51bWJlciA9PiB7XG5cdGZvciAobGV0IGkgPSBjdXJyZW50IC0gMjsgaSA+PSAwOyBpLS0pIHtcblx0XHRpZiAobWF0Y2hlc1tpXS5zb21lKG1hdGNoID0+IG1hdGNoLm1hdGNoLnR5cGUgIT09IE1hdGNoVHlwZS5ub25lKSkge1xuXHRcdFx0cmV0dXJuIGkgKyAxO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gY3VycmVudDtcbn07XG5cbi8qKlxuICogTWFyay9Vbm1hcmsgdGhlIG5leHQgbWF0Y2ggY29tcG9uZW50IGJhc2VkIG9uIHRoZSBwcmV2aW91c2x5IG1hcmtlZCBjb21wb25lbnRcbiAqIEBwYXJhbSBwcmV2IHRoZSBwcmV2aW91c2x5IG1hcmtlZC91bm1hcmtlZCBtYXRjaFxuICogQHBhcmFtIG5leHQgdGhlIG1hdGNoIHRvIG1hcmsvdW5tYXJrIG5leHRcbiAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgbWF0Y2ggaXMgZXZlbnR1YWx5IGhpZ2hsaWdodGVkXG4gKi9cbmV4cG9ydCBjb25zdCBvblRleHRNYXRjaENoYW5nZSA9IChbcHJldiwgbmV4dF06IFtNYXRjaENvbXBvbmVudCwgTWF0Y2hDb21wb25lbnRdKSA9PiB7XG5cdGlmIChuZXh0KSB7XG5cdFx0aWYgKHByZXYgJiYgcHJldiAhPT0gbmV4dCkge1xuXHRcdFx0cHJldi5mb2N1c2VkID0gZmFsc2U7XG5cdFx0fVxuXHRcdG5leHQuZm9jdXNlZCA9ICFuZXh0LmZvY3VzZWQ7XG5cdH0gZWxzZSB7XG5cdFx0aWYgKHByZXYpIHtcblx0XHRcdHByZXYuZm9jdXNlZCA9IGZhbHNlO1xuXHRcdH1cblx0fVxufTtcbiJdfQ==