import { EndpointKind, MatchType, } from '../models';
import { EMatchClassification } from '../models/AIMatch';
/** A reduce function to extrace `MatchEndpoint`s */
const extractMatchEndpoints = (acc, curr) => {
    acc.push({
        index: curr.start,
        type: curr.type,
        kind: EndpointKind.start,
        ids: [...curr.ids],
        gid: curr.gid,
        reason: curr.reason,
    });
    acc.push({
        index: curr.end,
        type: curr.type,
        kind: EndpointKind.end,
        ids: [...curr.ids],
        gid: curr.gid,
        reason: curr.reason,
    });
    return acc;
};
/**
 * Takes a list of matches and push the missing gaps as matches with type of MatchType.none
 */
export const fillMissingGaps = (intervals, length) => {
    let start = 0;
    const end = length;
    if (intervals.length === 0) {
        return [{ start, end, type: MatchType.none }];
    }
    for (let i = 0; i < intervals.length; i++) {
        const current = intervals[i];
        if (start < current.start) {
            intervals.splice(i, 0, { start, end: current.start, type: MatchType.none });
            i++;
        }
        start = current.end;
    }
    const last = intervals[intervals.length - 1];
    if (intervals[intervals.length - 1].end < end) {
        intervals.push({ start: last.end || 0, end, type: MatchType.none });
    }
    return intervals;
};
/**
 * divide a list of `matches` into nests of none distinct ranges
 * @param matches the base `matches` to process
 */
export const findNests = (matches) => {
    if (matches.length === 0) {
        return [];
    }
    matches.sort((a, b) => a.start - b.start || a.end - b.end || a.type - b.type);
    const nests = [[matches[0]]];
    let nestFurthestEnd = matches[0].end;
    let nestFurthestReason = matches[0].reason;
    for (const interval of matches.slice(1)) {
        if (interval.start > nestFurthestEnd ||
            (interval.start === nestFurthestEnd && interval.reason !== nestFurthestReason)) {
            nests.push([interval]);
            nestFurthestEnd = interval.end;
        }
        else {
            nests[nests.length - 1].push(interval);
            nestFurthestEnd = Math.max(nestFurthestEnd, interval.end);
        }
        nestFurthestReason = interval.reason;
    }
    return nests;
};
/**
 * merge the overlapping ranges (matches) within a list of none distinct ranges
 * preserving the match ids and deciding the match type based on priority
 * @param matches the matches to merge - should not include distinct ranges (gaps)
 */
const mergeMatchesInNest = (matches) => {
    const uniqueMatches = matches.slice(1).reduce((prev, curr) => {
        const last = prev[prev.length - 1];
        if (last.start === curr.start && last.end === curr.end) {
            last.type = Math.min(last.type, curr.type);
            if (last.ids.indexOf(curr.ids[0]) === -1) {
                last.ids.push(curr.ids[0]);
            }
        }
        else {
            prev.push(curr);
        }
        return prev;
    }, [matches[0]]);
    const endpoints = uniqueMatches
        .reduce(extractMatchEndpoints, [])
        .sort((a, b) => a.index - b.index || b.kind - a.kind);
    const subMatches = [];
    const idMap = {};
    const types = [0, 0, 0, 0];
    let start;
    for (const { index, type, ids, kind, gid, reason } of endpoints) {
        if (kind === EndpointKind.start) {
            if (start !== undefined) {
                if (index !== start) {
                    const participatingIds = Object.entries(idMap)
                        .filter(([, value]) => value > 0)
                        .map(([key]) => key);
                    subMatches.push({
                        start,
                        end: index,
                        type: types.findIndex(x => x > 0),
                        ids: participatingIds,
                        gid,
                        reason,
                    });
                }
            }
            ids.forEach(id => (idMap[id] = (idMap[id] || 0) + 1));
            types[type]++;
            start = index;
        }
        if (kind === EndpointKind.end) {
            if (index !== start) {
                const participatingIds = Object.entries(idMap)
                    .filter(([, value]) => value > 0)
                    .map(([key]) => key);
                subMatches.push({ start, end: index, type: types.findIndex(x => x > 0), ids: participatingIds, gid, reason });
            }
            ids.forEach(id => (idMap[id] = (idMap[id] || 0) - 1));
            types[type]--;
            start = Object.entries(idMap).filter(([, value]) => value > 0).length === 0 ? undefined : index;
        }
    }
    const result = subMatches.slice(1).reduce((prev, curr) => {
        const last = prev[prev.length - 1];
        if (last.type === curr.type && curr.ids.sort().join(',') === last.ids.sort().join(',')) {
            last.end = curr.end;
        }
        else {
            prev.push(curr);
        }
        return prev;
    }, [subMatches[0]]);
    return result;
};
/**
 * merge a list of matches , removing overlaps while preserving the match attributes
 * @param matches the list of matches
 */
export const mergeMatches = (matches) => {
    const nests = findNests(matches);
    const merged = nests.reduce((prev, nest) => {
        const joined = mergeMatchesInNest(nest);
        return prev.concat(joined);
    }, []);
    return merged;
};
/**
 * split `content` according to the given `matches` the result should contain a list of matches
 * for every page according to `pages`
 * @param content a string representing scan **text** or **html**
 * @param pages an array where every element is a start position of a page
 * @param matches `matches` containing the data to slice the `content`
 */
export const paginateMatches = (content, pages, matches) => {
    const result = [[]];
    let page = 0;
    for (let match of matches) {
        if (match.start >= pages[page + 1]) {
            page++;
            result[page] = [];
        }
        if (match.end < pages[page + 1]) {
            result[page].push({ content: content.slice(match.start, match.end), match });
        }
        else {
            while (match.end > pages[page + 1]) {
                const complement = { ...match, start: pages[page + 1] };
                match.end = pages[page + 1] - 1;
                result[page].push({ content: content.slice(match.start, match.end), match });
                match = complement;
                page++;
                result[page] = [];
            }
            result[page].push({ content: content.slice(match.start, match.end), match });
        }
    }
    return result;
};
/**
 * Higher order function that returns a function that extracts Match Intervals from a Result
 * @param comparison name of the comparison type to extract ( identical | minorChanges | relatedMeaning)
 * @param content name of the content to extract from ( text | html )
 * @param subject name of the subject to extract from ( source | suspected)
 */
const extractMatches = (comparison, content, subject) => (item) => {
    const { result, id } = item;
    if (!result || !result[content] || !result[content].comparison) {
        return [];
    }
    const gids = result[content].comparison[comparison].groupId || [];
    const { starts, lengths } = result[content].comparison[comparison][subject].chars;
    return starts.map((start, i) => ({
        start,
        end: start + lengths[i],
        type: MatchType[comparison],
        ids: [id],
        gid: gids[i],
    }));
};
/**
 * Higher order function that returns a function that extracts Excluded intervals from the source document
 * @param content name of the content to extract from (text | html)
 */
const extractExcluded = (content) => (source) => {
    if (!source[content].exclude) {
        return [];
    }
    const { starts, lengths, groupIds, reasons } = source[content].exclude;
    return starts.map((start, i) => ({
        start,
        end: start + lengths[i],
        type: MatchType.excluded,
        reason: reasons[i],
        ids: [],
        gid: groupIds && groupIds[i],
    }));
};
/** A function to extract `identical` matches from the `text` of a `source` document */
export const sourceTextIdentical = extractMatches('identical', 'text', 'source');
/** A function to extract `relatedMeaning` matches from the `text` of a `source` document */
export const sourceTextRelatedMeaning = extractMatches('relatedMeaning', 'text', 'source');
/** A function to extract `minorChanges` matches from the `text` of a `source` document */
export const sourceTextMinorChanges = extractMatches('minorChanges', 'text', 'source');
/** A function to extract `identical` matches from the `html` of a `source` document */
export const sourceHtmlIdentical = extractMatches('identical', 'html', 'source');
/** A function to extract `relatedMeaning` matches from the `html` of a `source` document */
export const sourceHtmlRelatedMeaning = extractMatches('relatedMeaning', 'html', 'source');
/** A function to extract `minorChanges` matches from the `html` of a `source` document */
export const sourceHtmlMinorChanges = extractMatches('minorChanges', 'html', 'source');
/** A function to extract `identical` matches from the `text` of a `suspect` document */
export const suspectTextIdentical = extractMatches('identical', 'text', 'suspected');
/** A function to extract `relatedMeaning` matches from the `text` of a `suspect` document */
export const suspectTextRelatedMeaning = extractMatches('relatedMeaning', 'text', 'suspected');
/** A function to extract `minorChanges` matches from the `text` of a `suspect` document */
export const suspectTextMinorChanges = extractMatches('minorChanges', 'text', 'suspected');
/** A function to extract `identical` matches from the `html` of a `suspect` document */
export const suspectHtmlIdentical = extractMatches('identical', 'html', 'suspected');
/** A function to extract `relatedMeaning` matches from the `html` of a `suspect` document */
export const suspectHtmlRelatedMeaning = extractMatches('relatedMeaning', 'html', 'suspected');
/** A function to extract `minorChanges` matches from the `html` of a `suspect` document */
export const suspectHtmlMinorChanges = extractMatches('minorChanges', 'html', 'suspected');
/** A function to extract `excluded` matches from the `text` of a `source` document */
export const sourceTextExcluded = extractExcluded('text');
/** A function to extract `excluded` matches from the `html` of a `source` document */
export const sourceHtmlExcluded = extractExcluded('html');
/**
 * Locate the respective match start index for a given index in the given comparison.
 * If `fromSource` is set to true, the initial index is assumed to be from the comparison source
 * and therefore will search in the respective `ComparisonData`. Returns a tuple of two indices
 * where the first number is start index of the respective match, and the second is the start index
 * of the closest match to the initially given index
 * @param index a position on the text/html that covers a match
 * @param comparison comparison relevant to the match type and associated content
 * @param fromSource flag indicating that `index` is coming from the source suspect
 */
export const findRespectiveStart = (index, comparison, fromSource = true) => {
    const { source, suspected } = comparison;
    const [from, to] = fromSource ? [source, suspected] : [suspected, source];
    const found = from.chars.starts.findIndex((s, i) => s <= index && index <= s + source.chars.lengths[i]);
    return [to.chars.starts[found], from.chars.starts[found]];
};
/**
 * This function will process one or more results and generate a list of match intervals that will help
 * highlight the source html with respect to user settings and match type priority
 * @param results one or more result item on which the calculation will be based on
 * @param settings the current user settings
 * @param source the scan source
 * @param text `true` if calculation should base on text comparison, `false` for html
 */
export const processSourceText = (results, settings, source, text = true) => {
    // if (!source || !source.text) {
    // 	return null;
    // }
    const items = [].concat(results);
    const identical = settings.showIdentical
        ? items.reduce((acc, res) => acc.concat((text ? sourceTextIdentical : sourceHtmlIdentical)(res)), [])
        : [];
    const minor = settings.showMinorChanges
        ? items.reduce((acc, res) => acc.concat((text ? sourceTextMinorChanges : sourceHtmlMinorChanges)(res)), [])
        : [];
    const related = settings.showRelated
        ? items.reduce((acc, res) => acc.concat((text ? sourceTextRelatedMeaning : sourceHtmlRelatedMeaning)(res)), [])
        : [];
    const excluded = sourceTextExcluded(source);
    const grouped = mergeMatches([...identical, ...minor, ...related, ...excluded]);
    const filled = fillMissingGaps(grouped, source.text.value.length);
    return paginateMatches(source.text.value, source.text.pages.startPosition, filled);
};
/**
 * This function will process notifications and generate a list of match intervals that will help
 * highlight the source text.
 * @param source the scan source
 * @param alertToMatch alert to process
 */
export const processSuspectedCharacterMatches = (source, alertToMatch) => {
    const matches = [];
    const data = JSON.parse(alertToMatch.additionalData);
    if (data && data.starts && data.lengths) {
        for (let i = 0; i < data.starts.length; i++) {
            matches.push({
                start: data.starts[i],
                end: data.starts[i] + data.lengths[i],
                type: MatchType.suspectedCharacterReplacement,
                ids: [],
            });
        }
    }
    const grouped = matches;
    const filled = fillMissingGaps(grouped, source.text.value.length);
    return paginateMatches(source.text.value, source.text.pages.startPosition, filled);
};
/**
 * This function will process notifications and generate a list of match intervals that will help
 * highlight the source text.
 * @param source the scan source
 * @param alertToMatch alert to process
 */
export const processAICheatingMatches = (source, alertToMatch) => {
    const matches = [];
    var scanResult = JSON.parse(alertToMatch.additionalData);
    scanResult?.results?.forEach(result => {
        result?.matches?.forEach((match) => {
            const mappedMatches = match?.text.chars?.starts?.map((start, idx) => ({
                start,
                end: start + match.text.chars.lengths[idx],
                type: result.classification == EMatchClassification.AI ? MatchType.aiText : MatchType.none,
                ids: [],
                classification: result.classification,
                probability: result.probability,
                totalWords: match.text.words.lengths[idx],
            }));
            if (mappedMatches)
                matches.push(...mappedMatches);
        });
    });
    const grouped = matches;
    const filled = fillMissingGaps(grouped, source.text.value.length);
    return paginateMatches(source.text.value, source.text.pages.startPosition, filled);
};
/**
 * This function will process one result and generate a list of match intervals that will help
 * highlight the suspect text with respect to user options and match type priority
 * @param suspect the suspect result item
 * @param options the current user options
 * @param text `true` if calculation should base on text comparison, `false` for html
 */
export const processSuspectText = (suspect, options, text = true) => {
    const identical = options.showIdentical ? (text ? suspectTextIdentical : suspectHtmlIdentical)(suspect) : [];
    const minor = options.showMinorChanges ? (text ? suspectTextMinorChanges : suspectHtmlMinorChanges)(suspect) : [];
    const related = options.showRelated ? (text ? suspectTextRelatedMeaning : suspectHtmlRelatedMeaning)(suspect) : [];
    const grouped = mergeMatches([...identical, ...minor, ...related]);
    const filled = fillMissingGaps(grouped, suspect.result.text.value.length);
    const final = paginateMatches(suspect.result.text.value, suspect.result.text.pages.startPosition, filled);
    return final;
};
/**
 * This function will process one or more results and generate a list of match intervals that will help
 * highlight the source html with respect to user options and match type priority
 * @param results one or more result item on which the calculation will be based on
 * @param options the current user options
 * @param source the scan source
 */
export const processSourceHtml = (results, options, source) => {
    if (!source || !source.html) {
        return null;
    }
    const items = [].concat(results);
    const identical = options.showIdentical ? items.reduce((acc, res) => acc.concat(sourceHtmlIdentical(res)), []) : [];
    const minor = options.showMinorChanges ? items.reduce((acc, res) => acc.concat(sourceHtmlMinorChanges(res)), []) : [];
    const related = options.showRelated ? items.reduce((acc, res) => acc.concat(sourceHtmlRelatedMeaning(res)), []) : [];
    const excluded = sourceHtmlExcluded(source);
    const grouped = mergeMatches([...identical, ...minor, ...related, ...excluded]);
    const final = fillMissingGaps(grouped, source.html.value.length);
    return final;
};
/**
 * This function will process one result and generate a list of match intervals that
 * will help highlight the suspect html with respect to user options and match type priority
 * @param suspect the suspect result item
 * @param options the current user options
 */
export const processSuspectHtml = (suspect, options) => {
    if (!suspect || !suspect.result.html) {
        return null;
    }
    const identical = options.showIdentical ? suspectHtmlIdentical(suspect) : [];
    const minor = options.showMinorChanges ? suspectHtmlMinorChanges(suspect) : [];
    const related = options.showRelated ? suspectHtmlRelatedMeaning(suspect) : [];
    const grouped = mergeMatches([...identical, ...minor, ...related]);
    return fillMissingGaps(grouped, suspect.result.html.value.length);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWF0Y2gtaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3BsYWdpYXJpc20tcmVwb3J0L3NyYy9saWIvcGxhZ2lhcmlzbS1yZXBvcnQvdXRpbHMvbWF0Y2gtaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBTU4sWUFBWSxFQUdaLFNBQVMsR0FLVCxNQUFNLFdBQVcsQ0FBQztBQUNuQixPQUFPLEVBQTRDLG9CQUFvQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFbkcsb0RBQW9EO0FBQ3BELE1BQU0scUJBQXFCLEdBQUcsQ0FBQyxHQUFvQixFQUFFLElBQVcsRUFBbUIsRUFBRTtJQUNwRixHQUFHLENBQUMsSUFBSSxDQUFDO1FBQ1IsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO1FBQ2pCLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtRQUNmLElBQUksRUFBRSxZQUFZLENBQUMsS0FBSztRQUN4QixHQUFHLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7UUFDbEIsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO1FBQ2IsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO0tBQ25CLENBQUMsQ0FBQztJQUNILEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDUixLQUFLLEVBQUUsSUFBSSxDQUFDLEdBQUc7UUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7UUFDZixJQUFJLEVBQUUsWUFBWSxDQUFDLEdBQUc7UUFDdEIsR0FBRyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO1FBQ2xCLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRztRQUNiLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTTtLQUNuQixDQUFDLENBQUM7SUFDSCxPQUFPLEdBQUcsQ0FBQztBQUNaLENBQUMsQ0FBQztBQUVGOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sZUFBZSxH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QUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RELEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ2QsS0FBSyxHQUFHLEtBQUssQ0FBQztTQUNkO1FBQ0QsSUFBSSxJQUFJLEtBQUssWUFBWSxDQUFDLEdBQUcsRUFBRTtZQUM5QixJQUFJLEtBQUssS0FBSyxLQUFLLEVBQUU7Z0JBQ3BCLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7cUJBQzVDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztxQkFDaEMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3RCLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7YUFDOUc7WUFDRCxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0RCxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNkLEtBQUssR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1NBQ2hHO0tBQ0Q7SUFFRCxNQUFNLE1BQU0sR0FBWSxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FDakQsQ0FBQyxJQUFhLEVBQUUsSUFBVyxFQUFFLEVBQUU7UUFDOUIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFFbkMsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDdkYsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO1NBQ3BCO2FBQU07WUFDTixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2hCO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDYixDQUFDLEVBQ0QsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FDZixDQUFDO0lBQ0YsT0FBTyxNQUFNLENBQUM7QUFDZixDQUFDLENBQUM7QUFFRjs7O0dBR0c7QUFDSCxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsQ0FBQyxPQUFnQixFQUFXLEVBQUU7SUFDekQsTUFBTSxLQUFLLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2pDLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFhLEVBQUUsSUFBYSxFQUFFLEVBQUU7UUFDNUQsTUFBTSxNQUFNLEdBQUcsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVCLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNQLE9BQU8sTUFBTSxDQUFDO0FBQ2YsQ0FBQyxDQUFDO0FBRUY7Ozs7OztHQU1HO0FBQ0gsTUFBTSxDQUFDLE1BQU0sZUFBZSxHQUFHLENBQUMsT0FBZSxFQUFFLEtBQWUsRUFBRSxPQUFnQixFQUFtQixFQUFFO0lBQ3RHLE1BQU0sTUFBTSxHQUFvQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQztJQUNiLEtBQUssSUFBSSxLQUFLLElBQUksT0FBTyxFQUFFO1FBQzFCLElBQUksS0FBSyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQ25DLElBQUksRUFBRSxDQUFDO1lBQ1AsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztTQUNsQjtRQUNELElBQUksS0FBSyxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQ2hDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQzdFO2FBQU07WUFDTixPQUFPLEtBQUssQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRTtnQkFDbkMsTUFBTSxVQUFVLEdBQUcsRUFBRSxHQUFHLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUN4RCxLQUFLLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztnQkFDN0UsS0FBSyxHQUFHLFVBQVUsQ0FBQztnQkFDbkIsSUFBSSxFQUFFLENBQUM7Z0JBQ1AsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQzthQUNsQjtZQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQzdFO0tBQ0Q7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNmLENBQUMsQ0FBQztBQUVGOzs7OztHQUtHO0FBQ0gsTUFBTSxjQUFjLEdBQ25CLENBQUMsVUFBeUIsRUFBRSxPQUFtQixFQUFFLE9BQXlCLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBZ0IsRUFBRSxFQUFFO0lBQ25HLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDO0lBQzVCLElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxFQUFFO1FBQy9ELE9BQU8sRUFBRSxDQUFDO0tBQ1Y7SUFDRCxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFDbEUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUNsRixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQ2hCLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBUyxFQUFFLENBQUMsQ0FBQztRQUNyQixLQUFLO1FBQ0wsR0FBRyxFQUFFLEtBQUssR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksRUFBRSxTQUFTLENBQUMsVUFBVSxDQUFDO1FBQzNCLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUNULEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0tBQ1osQ0FBQyxDQUNGLENBQUM7QUFDSCxDQUFDLENBQUM7QUFFSDs7O0dBR0c7QUFDSCxNQUFNLGVBQWUsR0FBRyxDQUFDLE9BQW1CLEVBQUUsRUFBRSxDQUFDLENBQUMsTUFBa0IsRUFBRSxFQUFFO0lBQ3ZFLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFO1FBQzdCLE9BQU8sRUFBRSxDQUFDO0tBQ1Y7SUFDRCxNQUFNLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUN2RSxPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQ2hCLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBUyxFQUFFLENBQUMsQ0FBQztRQUNyQixLQUFLO1FBQ0wsR0FBRyxFQUFFLEtBQUssR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksRUFBRSxTQUFTLENBQUMsUUFBUTtRQUN4QixNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNsQixHQUFHLEVBQUUsRUFBRTtRQUNQLEdBQUcsRUFBRSxRQUFRLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQztLQUM1QixDQUFDLENBQ0YsQ0FBQztBQUNILENBQUMsQ0FBQztBQUVGLHVGQUF1RjtBQUN2RixNQUFNLENBQUMsTUFBTSxtQkFBbUIsR0FBRyxjQUFjLENBQUMsV0FBVyxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztBQUVqRiw0RkFBNEY7QUFDNUYsTUFBTSxDQUFDLE1BQU0sd0JBQXdCLEdBQUcsY0FBYyxDQUFDLGdCQUFnQixFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztBQUUzRiwwRkFBMEY7QUFDMUYsTUFBTSxDQUFDLE1BQU0sc0JBQXNCLEdBQUcsY0FBYyxDQUFDLGNBQWMsRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFFdkYsdUZBQXVGO0FBQ3ZGLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHLGNBQWMsQ0FBQyxXQUFXLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBRWpGLDRGQUE0RjtBQUM1RixNQUFNLENBQUMsTUFBTSx3QkFBd0IsR0FBRyxjQUFjLENBQUMsZ0JBQWdCLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBRTNGLDBGQUEwRjtBQUMxRixNQUFNLENBQUMsTUFBTSxzQkFBc0IsR0FBRyxjQUFjLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztBQUV2Rix3RkFBd0Y7QUFDeEYsTUFBTSxDQUFDLE1BQU0sb0JBQW9CLEdBQUcsY0FBYyxDQUFDLFdBQVcsRUFBRSxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFFckYsNkZBQTZGO0FBQzdGLE1BQU0sQ0FBQyxNQUFNLHlCQUF5QixHQUFHLGNBQWMsQ0FBQyxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFFL0YsMkZBQTJGO0FBQzNGLE1BQU0sQ0FBQyxNQUFNLHVCQUF1QixHQUFHLGNBQWMsQ0FBQyxjQUFjLEVBQUUsTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBRTNGLHdGQUF3RjtBQUN4RixNQUFNLENBQUMsTUFBTSxvQkFBb0IsR0FBRyxjQUFjLENBQUMsV0FBVyxFQUFFLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztBQUVyRiw2RkFBNkY7QUFDN0YsTUFBTSxDQUFDLE1BQU0seUJBQXlCLEdBQUcsY0FBYyxDQUFDLGdCQUFnQixFQUFFLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztBQUUvRiwyRkFBMkY7QUFDM0YsTUFBTSxDQUFDLE1BQU0sdUJBQXVCLEdBQUcsY0FBYyxDQUFDLGNBQWMsRUFBRSxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFFM0Ysc0ZBQXNGO0FBQ3RGLE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUUxRCxzRkFBc0Y7QUFDdEYsTUFBTSxDQUFDLE1BQU0sa0JBQWtCLEdBQUcsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBRTFEOzs7Ozs7Ozs7R0FTRztBQUNILE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHLENBQUMsS0FBYSxFQUFFLFVBQXNCLEVBQUUsVUFBVSxHQUFHLElBQUksRUFBb0IsRUFBRTtJQUNqSCxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLFVBQVUsQ0FBQztJQUN6QyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzFFLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxLQUFLLElBQUksS0FBSyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3hHLE9BQU8sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0FBQzNELENBQUMsQ0FBQztBQUVGOzs7Ozs7O0dBT0c7QUFDSCxNQUFNLENBQUMsTUFBTSxpQkFBaUIsR0FBRyxDQUNoQyxPQUFrQyxFQUNsQyxRQUFnQyxFQUNoQyxNQUFrQixFQUNsQixPQUFnQixJQUFJLEVBQ25CLEVBQUU7SUFDSCxpQ0FBaUM7SUFDakMsZ0JBQWdCO0lBQ2hCLElBQUk7SUFDSixNQUFNLEtBQUssR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2pDLE1BQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhO1FBQ3ZDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDckcsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUNOLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxnQkFBZ0I7UUFDdEMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMzRyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ04sTUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLFdBQVc7UUFDbkMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMvRyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ04sTUFBTSxRQUFRLEdBQUcsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDNUMsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLENBQUMsR0FBRyxTQUFTLEVBQUUsR0FBRyxLQUFLLEVBQUUsR0FBRyxPQUFPLEVBQUUsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ2hGLE1BQU0sTUFBTSxHQUFHLGVBQWUsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbEUsT0FBTyxlQUFlLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ3BGLENBQUMsQ0FBQztBQUVGOzs7OztHQUtHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sZ0NBQWdDLEdBQUcsQ0FDL0MsTUFBa0IsRUFDbEIsWUFBNkMsRUFDM0IsRUFBRTtJQUNwQixNQUFNLE9BQU8sR0FBWSxFQUFFLENBQUM7SUFDNUIsTUFBTSxJQUFJLEdBR04sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDNUMsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1FBQ3hDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM1QyxPQUFPLENBQUMsSUFBSSxDQUFDO2dCQUNaLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDckIsR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQ3JDLElBQUksRUFBRSxTQUFTLENBQUMsNkJBQTZCO2dCQUM3QyxHQUFHLEVBQUUsRUFBRTthQUNQLENBQUMsQ0FBQztTQUNIO0tBQ0Q7SUFFRCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDeEIsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNsRSxPQUFPLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDcEYsQ0FBQyxDQUFDO0FBRUY7Ozs7O0dBS0c7QUFDSCxNQUFNLENBQUMsTUFBTSx3QkFBd0IsR0FBRyxDQUN2QyxNQUFrQixFQUNsQixZQUE2QyxFQUMzQixFQUFFO0lBQ3BCLE1BQU0sT0FBTyxHQUFZLEVBQUUsQ0FBQztJQUM1QixJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQWlCLENBQUM7SUFDekUsVUFBVSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7UUFDckMsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQyxLQUF3QixFQUFFLEVBQUU7WUFDckQsTUFBTSxhQUFhLEdBQUcsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FDbkQsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FDZCxDQUFDO2dCQUNBLEtBQUs7Z0JBQ0wsR0FBRyxFQUFFLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDO2dCQUMxQyxJQUFJLEVBQUUsTUFBTSxDQUFDLGNBQWMsSUFBSSxvQkFBb0IsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJO2dCQUMxRixHQUFHLEVBQUUsRUFBRTtnQkFDUCxjQUFjLEVBQUUsTUFBTSxDQUFDLGNBQWM7Z0JBQ3JDLFdBQVcsRUFBRSxNQUFNLENBQUMsV0FBVztnQkFDL0IsVUFBVSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUM7YUFDN0IsQ0FBQSxDQUNkLENBQUM7WUFDRixJQUFJLGFBQWE7Z0JBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLGFBQWEsQ0FBQyxDQUFDO1FBQ25ELENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7SUFFSCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDeEIsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNsRSxPQUFPLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDcEYsQ0FBQyxDQUFDO0FBRUY7Ozs7OztHQU1HO0FBQ0gsTUFBTSxDQUFDLE1BQU0sa0JBQWtCLEdBQUcsQ0FDakMsT0FBbUIsRUFDbkIsT0FBK0IsRUFDL0IsT0FBZ0IsSUFBSSxFQUNGLEVBQUU7SUFDcEIsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDN0csTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDLHVCQUF1QixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUNsSCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLHlCQUF5QixDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUNuSCxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsQ0FBQyxHQUFHLFNBQVMsRUFBRSxHQUFHLEtBQUssRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDbkUsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDMUUsTUFBTSxLQUFLLEdBQUcsZUFBZSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzFHLE9BQU8sS0FBSyxDQUFDO0FBQ2QsQ0FBQyxDQUFDO0FBRUY7Ozs7OztHQU1HO0FBQ0gsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsQ0FDaEMsT0FBa0MsRUFDbEMsT0FBK0IsRUFDL0IsTUFBa0IsRUFDakIsRUFBRTtJQUNILElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO1FBQzVCLE9BQU8sSUFBSSxDQUFDO0tBQ1o7SUFDRCxNQUFNLEtBQUssR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2pDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUNwSCxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUN0SCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyx3QkFBd0IsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDckgsTUFBTSxRQUFRLEdBQUcsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDNUMsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLENBQUMsR0FBRyxTQUFTLEVBQUUsR0FBRyxLQUFLLEVBQUUsR0FBRyxPQUFPLEVBQUUsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ2hGLE1BQU0sS0FBSyxHQUFHLGVBQWUsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDakUsT0FBTyxLQUFLLENBQUM7QUFDZCxDQUFDLENBQUM7QUFFRjs7Ozs7R0FLRztBQUNILE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUFHLENBQUMsT0FBbUIsRUFBRSxPQUErQixFQUFXLEVBQUU7SUFDbkcsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO1FBQ3JDLE9BQU8sSUFBSSxDQUFDO0tBQ1o7SUFDRCxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQzdFLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsdUJBQXVCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUMvRSxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQzlFLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxDQUFDLEdBQUcsU0FBUyxFQUFFLEdBQUcsS0FBSyxFQUFFLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUNuRSxPQUFPLGVBQWUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ25FLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG5cdENvbXBhcmlzb24sXG5cdENvbXBhcmlzb25LZXksXG5cdENvbXBsZXRlUmVzdWx0Tm90aWZpY2F0aW9uQWxlcnQsXG5cdENvbnRlbnRLZXksXG5cdENvcHlsZWFrc1JlcG9ydE9wdGlvbnMsXG5cdEVuZHBvaW50S2luZCxcblx0TWF0Y2gsXG5cdE1hdGNoRW5kcG9pbnQsXG5cdE1hdGNoVHlwZSxcblx0UmVzdWx0SXRlbSxcblx0U2NhblNvdXJjZSxcblx0U2xpY2VkTWF0Y2gsXG5cdFN1YmplY3RSZXN1bHRLZXksXG59IGZyb20gJy4uL21vZGVscyc7XG5pbXBvcnQgeyBBSU1hdGNoLCBBSVNjYW5SZXN1bHQsIEFJU2NhblJlc3VsdE1hdGNoLCBFTWF0Y2hDbGFzc2lmaWNhdGlvbiB9IGZyb20gJy4uL21vZGVscy9BSU1hdGNoJztcblxuLyoqIEEgcmVkdWNlIGZ1bmN0aW9uIHRvIGV4dHJhY2UgYE1hdGNoRW5kcG9pbnRgcyAqL1xuY29uc3QgZXh0cmFjdE1hdGNoRW5kcG9pbnRzID0gKGFjYzogTWF0Y2hFbmRwb2ludFtdLCBjdXJyOiBNYXRjaCk6IE1hdGNoRW5kcG9pbnRbXSA9PiB7XG5cdGFjYy5wdXNoKHtcblx0XHRpbmRleDogY3Vyci5zdGFydCxcblx0XHR0eXBlOiBjdXJyLnR5cGUsXG5cdFx0a2luZDogRW5kcG9pbnRLaW5kLnN0YXJ0LFxuXHRcdGlkczogWy4uLmN1cnIuaWRzXSxcblx0XHRnaWQ6IGN1cnIuZ2lkLFxuXHRcdHJlYXNvbjogY3Vyci5yZWFzb24sXG5cdH0pO1xuXHRhY2MucHVzaCh7XG5cdFx0aW5kZXg6IGN1cnIuZW5kLFxuXHRcdHR5cGU6IGN1cnIudHlwZSxcblx0XHRraW5kOiBFbmRwb2ludEtpbmQuZW5kLFxuXHRcdGlkczogWy4uLmN1cnIuaWRzXSxcblx0XHRnaWQ6IGN1cnIuZ2lkLFxuXHRcdHJlYXNvbjogY3Vyci5yZWFzb24sXG5cdH0pO1xuXHRyZXR1cm4gYWNjO1xufTtcblxuLyoqXG4gKiBUYWtlcyBhIGxpc3Qgb2YgbWF0Y2hlcyBhbmQgcHVzaCB0aGUgbWlzc2luZyBnYXBzIGFzIG1hdGNoZXMgd2l0aCB0eXBlIG9mIE1hdGNoVHlwZS5ub25lXG4gKi9cbmV4cG9ydCBjb25zdCBmaWxsTWlzc2luZ0dhcHMgPSAoaW50ZXJ2YWxzOiBNYXRjaFtdLCBsZW5ndGg6IG51bWJlcik6IE1hdGNoW10gPT4ge1xuXHRsZXQgc3RhcnQgPSAwO1xuXHRjb25zdCBlbmQgPSBsZW5ndGg7XG5cdGlmIChpbnRlcnZhbHMubGVuZ3RoID09PSAwKSB7XG5cdFx0cmV0dXJuIFt7IHN0YXJ0LCBlbmQsIHR5cGU6IE1hdGNoVHlwZS5ub25lIH1dO1xuXHR9XG5cdGZvciAobGV0IGkgPSAwOyBpIDwgaW50ZXJ2YWxzLmxlbmd0aDsgaSsrKSB7XG5cdFx0Y29uc3QgY3VycmVudCA9IGludGVydmFsc1tpXTtcblx0XHRpZiAoc3RhcnQgPCBjdXJyZW50LnN0YXJ0KSB7XG5cdFx0XHRpbnRlcnZhbHMuc3BsaWNlKGksIDAsIHsgc3RhcnQsIGVuZDogY3VycmVudC5zdGFydCwgdHlwZTogTWF0Y2hUeXBlLm5vbmUgfSk7XG5cdFx0XHRpKys7XG5cdFx0fVxuXHRcdHN0YXJ0ID0gY3VycmVudC5lbmQ7XG5cdH1cblx0Y29uc3QgbGFzdCA9IGludGVydmFsc1tpbnRlcnZhbHMubGVuZ3RoIC0gMV07XG5cdGlmIChpbnRlcnZhbHNbaW50ZXJ2YWxzLmxlbmd0aCAtIDFdLmVuZCA8IGVuZCkge1xuXHRcdGludGVydmFscy5wdXNoKHsgc3RhcnQ6IGxhc3QuZW5kIHx8IDAsIGVuZCwgdHlwZTogTWF0Y2hUeXBlLm5vbmUgfSk7XG5cdH1cblx0cmV0dXJuIGludGVydmFscztcbn07XG5cbi8qKlxuICogZGl2aWRlIGEgbGlzdCBvZiBgbWF0Y2hlc2AgaW50byBuZXN0cyBvZiBub25lIGRpc3RpbmN0IHJhbmdlc1xuICogQHBhcmFtIG1hdGNoZXMgdGhlIGJhc2UgYG1hdGNoZXNgIHRvIHByb2Nlc3NcbiAqL1xuZXhwb3J0IGNvbnN0IGZpbmROZXN0cyA9IChtYXRjaGVzOiBNYXRjaFtdKTogTWF0Y2hbXVtdID0+IHtcblx0aWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG5cdFx0cmV0dXJuIFtdO1xuXHR9XG5cdG1hdGNoZXMuc29ydCgoYSwgYikgPT4gYS5zdGFydCAtIGIuc3RhcnQgfHwgYS5lbmQgLSBiLmVuZCB8fCBhLnR5cGUgLSBiLnR5cGUpO1xuXHRjb25zdCBuZXN0czogTWF0Y2hbXVtdID0gW1ttYXRjaGVzWzBdXV07XG5cdGxldCBuZXN0RnVydGhlc3RFbmQgPSBtYXRjaGVzWzBdLmVuZDtcblx0bGV0IG5lc3RGdXJ0aGVzdFJlYXNvbiA9IG1hdGNoZXNbMF0ucmVhc29uO1xuXG5cdGZvciAoY29uc3QgaW50ZXJ2YWwgb2YgbWF0Y2hlcy5zbGljZSgxKSkge1xuXHRcdGlmIChcblx0XHRcdGludGVydmFsLnN0YXJ0ID4gbmVzdEZ1cnRoZXN0RW5kIHx8XG5cdFx0XHQoaW50ZXJ2YWwuc3RhcnQgPT09IG5lc3RGdXJ0aGVzdEVuZCAmJiBpbnRlcnZhbC5yZWFzb24gIT09IG5lc3RGdXJ0aGVzdFJlYXNvbilcblx0XHQpIHtcblx0XHRcdG5lc3RzLnB1c2goW2ludGVydmFsXSk7XG5cdFx0XHRuZXN0RnVydGhlc3RFbmQgPSBpbnRlcnZhbC5lbmQ7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG5lc3RzW25lc3RzLmxlbmd0aCAtIDFdLnB1c2goaW50ZXJ2YWwpO1xuXHRcdFx0bmVzdEZ1cnRoZXN0RW5kID0gTWF0aC5tYXgobmVzdEZ1cnRoZXN0RW5kLCBpbnRlcnZhbC5lbmQpO1xuXHRcdH1cblx0XHRuZXN0RnVydGhlc3RSZWFzb24gPSBpbnRlcnZhbC5yZWFzb247XG5cdH1cblx0cmV0dXJuIG5lc3RzO1xufTtcblxuLyoqXG4gKiBtZXJnZSB0aGUgb3ZlcmxhcHBpbmcgcmFuZ2VzIChtYXRjaGVzKSB3aXRoaW4gYSBsaXN0IG9mIG5vbmUgZGlzdGluY3QgcmFuZ2VzXG4gKiBwcmVzZXJ2aW5nIHRoZSBtYXRjaCBpZHMgYW5kIGRlY2lkaW5nIHRoZSBtYXRjaCB0eXBlIGJhc2VkIG9uIHByaW9yaXR5XG4gKiBAcGFyYW0gbWF0Y2hlcyB0aGUgbWF0Y2hlcyB0byBtZXJnZSAtIHNob3VsZCBub3QgaW5jbHVkZSBkaXN0aW5jdCByYW5nZXMgKGdhcHMpXG4gKi9cbmNvbnN0IG1lcmdlTWF0Y2hlc0luTmVzdCA9IChtYXRjaGVzOiBNYXRjaFtdKTogTWF0Y2hbXSA9PiB7XG5cdGNvbnN0IHVuaXF1ZU1hdGNoZXMgPSBtYXRjaGVzLnNsaWNlKDEpLnJlZHVjZShcblx0XHQocHJldjogTWF0Y2hbXSwgY3VycjogTWF0Y2gpID0+IHtcblx0XHRcdGNvbnN0IGxhc3QgPSBwcmV2W3ByZXYubGVuZ3RoIC0gMV07XG5cdFx0XHRpZiAobGFzdC5zdGFydCA9PT0gY3Vyci5zdGFydCAmJiBsYXN0LmVuZCA9PT0gY3Vyci5lbmQpIHtcblx0XHRcdFx0bGFzdC50eXBlID0gTWF0aC5taW4obGFzdC50eXBlLCBjdXJyLnR5cGUpO1xuXHRcdFx0XHRpZiAobGFzdC5pZHMuaW5kZXhPZihjdXJyLmlkc1swXSkgPT09IC0xKSB7XG5cdFx0XHRcdFx0bGFzdC5pZHMucHVzaChjdXJyLmlkc1swXSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHByZXYucHVzaChjdXJyKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBwcmV2O1xuXHRcdH0sXG5cdFx0W21hdGNoZXNbMF1dXG5cdCk7XG5cblx0Y29uc3QgZW5kcG9pbnRzID0gdW5pcXVlTWF0Y2hlc1xuXHRcdC5yZWR1Y2UoZXh0cmFjdE1hdGNoRW5kcG9pbnRzLCBbXSlcblx0XHQuc29ydCgoYSwgYikgPT4gYS5pbmRleCAtIGIuaW5kZXggfHwgYi5raW5kIC0gYS5raW5kKTtcblxuXHRjb25zdCBzdWJNYXRjaGVzOiBNYXRjaFtdID0gW107XG5cdGNvbnN0IGlkTWFwOiB7IFtrZXk6IHN0cmluZ106IG51bWJlciB9ID0ge307XG5cdGNvbnN0IHR5cGVzOiBudW1iZXJbXSA9IFswLCAwLCAwLCAwXTtcblx0bGV0IHN0YXJ0OiBudW1iZXI7XG5cdGZvciAoY29uc3QgeyBpbmRleCwgdHlwZSwgaWRzLCBraW5kLCBnaWQsIHJlYXNvbiB9IG9mIGVuZHBvaW50cykge1xuXHRcdGlmIChraW5kID09PSBFbmRwb2ludEtpbmQuc3RhcnQpIHtcblx0XHRcdGlmIChzdGFydCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdGlmIChpbmRleCAhPT0gc3RhcnQpIHtcblx0XHRcdFx0XHRjb25zdCBwYXJ0aWNpcGF0aW5nSWRzID0gT2JqZWN0LmVudHJpZXMoaWRNYXApXG5cdFx0XHRcdFx0XHQuZmlsdGVyKChbLCB2YWx1ZV0pID0+IHZhbHVlID4gMClcblx0XHRcdFx0XHRcdC5tYXAoKFtrZXldKSA9PiBrZXkpO1xuXHRcdFx0XHRcdHN1Yk1hdGNoZXMucHVzaCh7XG5cdFx0XHRcdFx0XHRzdGFydCxcblx0XHRcdFx0XHRcdGVuZDogaW5kZXgsXG5cdFx0XHRcdFx0XHR0eXBlOiB0eXBlcy5maW5kSW5kZXgoeCA9PiB4ID4gMCksXG5cdFx0XHRcdFx0XHRpZHM6IHBhcnRpY2lwYXRpbmdJZHMsXG5cdFx0XHRcdFx0XHRnaWQsXG5cdFx0XHRcdFx0XHRyZWFzb24sXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlkcy5mb3JFYWNoKGlkID0+IChpZE1hcFtpZF0gPSAoaWRNYXBbaWRdIHx8IDApICsgMSkpO1xuXHRcdFx0dHlwZXNbdHlwZV0rKztcblx0XHRcdHN0YXJ0ID0gaW5kZXg7XG5cdFx0fVxuXHRcdGlmIChraW5kID09PSBFbmRwb2ludEtpbmQuZW5kKSB7XG5cdFx0XHRpZiAoaW5kZXggIT09IHN0YXJ0KSB7XG5cdFx0XHRcdGNvbnN0IHBhcnRpY2lwYXRpbmdJZHMgPSBPYmplY3QuZW50cmllcyhpZE1hcClcblx0XHRcdFx0XHQuZmlsdGVyKChbLCB2YWx1ZV0pID0+IHZhbHVlID4gMClcblx0XHRcdFx0XHQubWFwKChba2V5XSkgPT4ga2V5KTtcblx0XHRcdFx0c3ViTWF0Y2hlcy5wdXNoKHsgc3RhcnQsIGVuZDogaW5kZXgsIHR5cGU6IHR5cGVzLmZpbmRJbmRleCh4ID0+IHggPiAwKSwgaWRzOiBwYXJ0aWNpcGF0aW5nSWRzLCBnaWQsIHJlYXNvbiB9KTtcblx0XHRcdH1cblx0XHRcdGlkcy5mb3JFYWNoKGlkID0+IChpZE1hcFtpZF0gPSAoaWRNYXBbaWRdIHx8IDApIC0gMSkpO1xuXHRcdFx0dHlwZXNbdHlwZV0tLTtcblx0XHRcdHN0YXJ0ID0gT2JqZWN0LmVudHJpZXMoaWRNYXApLmZpbHRlcigoWywgdmFsdWVdKSA9PiB2YWx1ZSA+IDApLmxlbmd0aCA9PT0gMCA/IHVuZGVmaW5lZCA6IGluZGV4O1xuXHRcdH1cblx0fVxuXG5cdGNvbnN0IHJlc3VsdDogTWF0Y2hbXSA9IHN1Yk1hdGNoZXMuc2xpY2UoMSkucmVkdWNlKFxuXHRcdChwcmV2OiBNYXRjaFtdLCBjdXJyOiBNYXRjaCkgPT4ge1xuXHRcdFx0Y29uc3QgbGFzdCA9IHByZXZbcHJldi5sZW5ndGggLSAxXTtcblxuXHRcdFx0aWYgKGxhc3QudHlwZSA9PT0gY3Vyci50eXBlICYmIGN1cnIuaWRzLnNvcnQoKS5qb2luKCcsJykgPT09IGxhc3QuaWRzLnNvcnQoKS5qb2luKCcsJykpIHtcblx0XHRcdFx0bGFzdC5lbmQgPSBjdXJyLmVuZDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHByZXYucHVzaChjdXJyKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBwcmV2O1xuXHRcdH0sXG5cdFx0W3N1Yk1hdGNoZXNbMF1dXG5cdCk7XG5cdHJldHVybiByZXN1bHQ7XG59O1xuXG4vKipcbiAqIG1lcmdlIGEgbGlzdCBvZiBtYXRjaGVzICwgcmVtb3Zpbmcgb3ZlcmxhcHMgd2hpbGUgcHJlc2VydmluZyB0aGUgbWF0Y2ggYXR0cmlidXRlc1xuICogQHBhcmFtIG1hdGNoZXMgdGhlIGxpc3Qgb2YgbWF0Y2hlc1xuICovXG5leHBvcnQgY29uc3QgbWVyZ2VNYXRjaGVzID0gKG1hdGNoZXM6IE1hdGNoW10pOiBNYXRjaFtdID0+IHtcblx0Y29uc3QgbmVzdHMgPSBmaW5kTmVzdHMobWF0Y2hlcyk7XG5cdGNvbnN0IG1lcmdlZCA9IG5lc3RzLnJlZHVjZSgocHJldjogTWF0Y2hbXSwgbmVzdDogTWF0Y2hbXSkgPT4ge1xuXHRcdGNvbnN0IGpvaW5lZCA9IG1lcmdlTWF0Y2hlc0luTmVzdChuZXN0KTtcblx0XHRyZXR1cm4gcHJldi5jb25jYXQoam9pbmVkKTtcblx0fSwgW10pO1xuXHRyZXR1cm4gbWVyZ2VkO1xufTtcblxuLyoqXG4gKiBzcGxpdCBgY29udGVudGAgYWNjb3JkaW5nIHRvIHRoZSBnaXZlbiBgbWF0Y2hlc2AgdGhlIHJlc3VsdCBzaG91bGQgY29udGFpbiBhIGxpc3Qgb2YgbWF0Y2hlc1xuICogZm9yIGV2ZXJ5IHBhZ2UgYWNjb3JkaW5nIHRvIGBwYWdlc2BcbiAqIEBwYXJhbSBjb250ZW50IGEgc3RyaW5nIHJlcHJlc2VudGluZyBzY2FuICoqdGV4dCoqIG9yICoqaHRtbCoqXG4gKiBAcGFyYW0gcGFnZXMgYW4gYXJyYXkgd2hlcmUgZXZlcnkgZWxlbWVudCBpcyBhIHN0YXJ0IHBvc2l0aW9uIG9mIGEgcGFnZVxuICogQHBhcmFtIG1hdGNoZXMgYG1hdGNoZXNgIGNvbnRhaW5pbmcgdGhlIGRhdGEgdG8gc2xpY2UgdGhlIGBjb250ZW50YFxuICovXG5leHBvcnQgY29uc3QgcGFnaW5hdGVNYXRjaGVzID0gKGNvbnRlbnQ6IHN0cmluZywgcGFnZXM6IG51bWJlcltdLCBtYXRjaGVzOiBNYXRjaFtdKTogU2xpY2VkTWF0Y2hbXVtdID0+IHtcblx0Y29uc3QgcmVzdWx0OiBTbGljZWRNYXRjaFtdW10gPSBbW11dO1xuXHRsZXQgcGFnZSA9IDA7XG5cdGZvciAobGV0IG1hdGNoIG9mIG1hdGNoZXMpIHtcblx0XHRpZiAobWF0Y2guc3RhcnQgPj0gcGFnZXNbcGFnZSArIDFdKSB7XG5cdFx0XHRwYWdlKys7XG5cdFx0XHRyZXN1bHRbcGFnZV0gPSBbXTtcblx0XHR9XG5cdFx0aWYgKG1hdGNoLmVuZCA8IHBhZ2VzW3BhZ2UgKyAxXSkge1xuXHRcdFx0cmVzdWx0W3BhZ2VdLnB1c2goeyBjb250ZW50OiBjb250ZW50LnNsaWNlKG1hdGNoLnN0YXJ0LCBtYXRjaC5lbmQpLCBtYXRjaCB9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0d2hpbGUgKG1hdGNoLmVuZCA+IHBhZ2VzW3BhZ2UgKyAxXSkge1xuXHRcdFx0XHRjb25zdCBjb21wbGVtZW50ID0geyAuLi5tYXRjaCwgc3RhcnQ6IHBhZ2VzW3BhZ2UgKyAxXSB9O1xuXHRcdFx0XHRtYXRjaC5lbmQgPSBwYWdlc1twYWdlICsgMV0gLSAxO1xuXHRcdFx0XHRyZXN1bHRbcGFnZV0ucHVzaCh7IGNvbnRlbnQ6IGNvbnRlbnQuc2xpY2UobWF0Y2guc3RhcnQsIG1hdGNoLmVuZCksIG1hdGNoIH0pO1xuXHRcdFx0XHRtYXRjaCA9IGNvbXBsZW1lbnQ7XG5cdFx0XHRcdHBhZ2UrKztcblx0XHRcdFx0cmVzdWx0W3BhZ2VdID0gW107XG5cdFx0XHR9XG5cdFx0XHRyZXN1bHRbcGFnZV0ucHVzaCh7IGNvbnRlbnQ6IGNvbnRlbnQuc2xpY2UobWF0Y2guc3RhcnQsIG1hdGNoLmVuZCksIG1hdGNoIH0pO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTtcblxuLyoqXG4gKiBIaWdoZXIgb3JkZXIgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBleHRyYWN0cyBNYXRjaCBJbnRlcnZhbHMgZnJvbSBhIFJlc3VsdFxuICogQHBhcmFtIGNvbXBhcmlzb24gbmFtZSBvZiB0aGUgY29tcGFyaXNvbiB0eXBlIHRvIGV4dHJhY3QgKCBpZGVudGljYWwgfCBtaW5vckNoYW5nZXMgfCByZWxhdGVkTWVhbmluZylcbiAqIEBwYXJhbSBjb250ZW50IG5hbWUgb2YgdGhlIGNvbnRlbnQgdG8gZXh0cmFjdCBmcm9tICggdGV4dCB8IGh0bWwgKVxuICogQHBhcmFtIHN1YmplY3QgbmFtZSBvZiB0aGUgc3ViamVjdCB0byBleHRyYWN0IGZyb20gKCBzb3VyY2UgfCBzdXNwZWN0ZWQpXG4gKi9cbmNvbnN0IGV4dHJhY3RNYXRjaGVzID1cblx0KGNvbXBhcmlzb246IENvbXBhcmlzb25LZXksIGNvbnRlbnQ6IENvbnRlbnRLZXksIHN1YmplY3Q6IFN1YmplY3RSZXN1bHRLZXkpID0+IChpdGVtOiBSZXN1bHRJdGVtKSA9PiB7XG5cdFx0Y29uc3QgeyByZXN1bHQsIGlkIH0gPSBpdGVtO1xuXHRcdGlmICghcmVzdWx0IHx8ICFyZXN1bHRbY29udGVudF0gfHwgIXJlc3VsdFtjb250ZW50XS5jb21wYXJpc29uKSB7XG5cdFx0XHRyZXR1cm4gW107XG5cdFx0fVxuXHRcdGNvbnN0IGdpZHMgPSByZXN1bHRbY29udGVudF0uY29tcGFyaXNvbltjb21wYXJpc29uXS5ncm91cElkIHx8IFtdO1xuXHRcdGNvbnN0IHsgc3RhcnRzLCBsZW5ndGhzIH0gPSByZXN1bHRbY29udGVudF0uY29tcGFyaXNvbltjb21wYXJpc29uXVtzdWJqZWN0XS5jaGFycztcblx0XHRyZXR1cm4gc3RhcnRzLm1hcChcblx0XHRcdChzdGFydCwgaSk6IE1hdGNoID0+ICh7XG5cdFx0XHRcdHN0YXJ0LFxuXHRcdFx0XHRlbmQ6IHN0YXJ0ICsgbGVuZ3Roc1tpXSxcblx0XHRcdFx0dHlwZTogTWF0Y2hUeXBlW2NvbXBhcmlzb25dLFxuXHRcdFx0XHRpZHM6IFtpZF0sXG5cdFx0XHRcdGdpZDogZ2lkc1tpXSxcblx0XHRcdH0pXG5cdFx0KTtcblx0fTtcblxuLyoqXG4gKiBIaWdoZXIgb3JkZXIgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBleHRyYWN0cyBFeGNsdWRlZCBpbnRlcnZhbHMgZnJvbSB0aGUgc291cmNlIGRvY3VtZW50XG4gKiBAcGFyYW0gY29udGVudCBuYW1lIG9mIHRoZSBjb250ZW50IHRvIGV4dHJhY3QgZnJvbSAodGV4dCB8IGh0bWwpXG4gKi9cbmNvbnN0IGV4dHJhY3RFeGNsdWRlZCA9IChjb250ZW50OiBDb250ZW50S2V5KSA9PiAoc291cmNlOiBTY2FuU291cmNlKSA9PiB7XG5cdGlmICghc291cmNlW2NvbnRlbnRdLmV4Y2x1ZGUpIHtcblx0XHRyZXR1cm4gW107XG5cdH1cblx0Y29uc3QgeyBzdGFydHMsIGxlbmd0aHMsIGdyb3VwSWRzLCByZWFzb25zIH0gPSBzb3VyY2VbY29udGVudF0uZXhjbHVkZTtcblx0cmV0dXJuIHN0YXJ0cy5tYXAoXG5cdFx0KHN0YXJ0LCBpKTogTWF0Y2ggPT4gKHtcblx0XHRcdHN0YXJ0LFxuXHRcdFx0ZW5kOiBzdGFydCArIGxlbmd0aHNbaV0sXG5cdFx0XHR0eXBlOiBNYXRjaFR5cGUuZXhjbHVkZWQsXG5cdFx0XHRyZWFzb246IHJlYXNvbnNbaV0sXG5cdFx0XHRpZHM6IFtdLFxuXHRcdFx0Z2lkOiBncm91cElkcyAmJiBncm91cElkc1tpXSxcblx0XHR9KVxuXHQpO1xufTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgaWRlbnRpY2FsYCBtYXRjaGVzIGZyb20gdGhlIGB0ZXh0YCBvZiBhIGBzb3VyY2VgIGRvY3VtZW50ICovXG5leHBvcnQgY29uc3Qgc291cmNlVGV4dElkZW50aWNhbCA9IGV4dHJhY3RNYXRjaGVzKCdpZGVudGljYWwnLCAndGV4dCcsICdzb3VyY2UnKTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgcmVsYXRlZE1lYW5pbmdgIG1hdGNoZXMgZnJvbSB0aGUgYHRleHRgIG9mIGEgYHNvdXJjZWAgZG9jdW1lbnQgKi9cbmV4cG9ydCBjb25zdCBzb3VyY2VUZXh0UmVsYXRlZE1lYW5pbmcgPSBleHRyYWN0TWF0Y2hlcygncmVsYXRlZE1lYW5pbmcnLCAndGV4dCcsICdzb3VyY2UnKTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgbWlub3JDaGFuZ2VzYCBtYXRjaGVzIGZyb20gdGhlIGB0ZXh0YCBvZiBhIGBzb3VyY2VgIGRvY3VtZW50ICovXG5leHBvcnQgY29uc3Qgc291cmNlVGV4dE1pbm9yQ2hhbmdlcyA9IGV4dHJhY3RNYXRjaGVzKCdtaW5vckNoYW5nZXMnLCAndGV4dCcsICdzb3VyY2UnKTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgaWRlbnRpY2FsYCBtYXRjaGVzIGZyb20gdGhlIGBodG1sYCBvZiBhIGBzb3VyY2VgIGRvY3VtZW50ICovXG5leHBvcnQgY29uc3Qgc291cmNlSHRtbElkZW50aWNhbCA9IGV4dHJhY3RNYXRjaGVzKCdpZGVudGljYWwnLCAnaHRtbCcsICdzb3VyY2UnKTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgcmVsYXRlZE1lYW5pbmdgIG1hdGNoZXMgZnJvbSB0aGUgYGh0bWxgIG9mIGEgYHNvdXJjZWAgZG9jdW1lbnQgKi9cbmV4cG9ydCBjb25zdCBzb3VyY2VIdG1sUmVsYXRlZE1lYW5pbmcgPSBleHRyYWN0TWF0Y2hlcygncmVsYXRlZE1lYW5pbmcnLCAnaHRtbCcsICdzb3VyY2UnKTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgbWlub3JDaGFuZ2VzYCBtYXRjaGVzIGZyb20gdGhlIGBodG1sYCBvZiBhIGBzb3VyY2VgIGRvY3VtZW50ICovXG5leHBvcnQgY29uc3Qgc291cmNlSHRtbE1pbm9yQ2hhbmdlcyA9IGV4dHJhY3RNYXRjaGVzKCdtaW5vckNoYW5nZXMnLCAnaHRtbCcsICdzb3VyY2UnKTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgaWRlbnRpY2FsYCBtYXRjaGVzIGZyb20gdGhlIGB0ZXh0YCBvZiBhIGBzdXNwZWN0YCBkb2N1bWVudCAqL1xuZXhwb3J0IGNvbnN0IHN1c3BlY3RUZXh0SWRlbnRpY2FsID0gZXh0cmFjdE1hdGNoZXMoJ2lkZW50aWNhbCcsICd0ZXh0JywgJ3N1c3BlY3RlZCcpO1xuXG4vKiogQSBmdW5jdGlvbiB0byBleHRyYWN0IGByZWxhdGVkTWVhbmluZ2AgbWF0Y2hlcyBmcm9tIHRoZSBgdGV4dGAgb2YgYSBgc3VzcGVjdGAgZG9jdW1lbnQgKi9cbmV4cG9ydCBjb25zdCBzdXNwZWN0VGV4dFJlbGF0ZWRNZWFuaW5nID0gZXh0cmFjdE1hdGNoZXMoJ3JlbGF0ZWRNZWFuaW5nJywgJ3RleHQnLCAnc3VzcGVjdGVkJyk7XG5cbi8qKiBBIGZ1bmN0aW9uIHRvIGV4dHJhY3QgYG1pbm9yQ2hhbmdlc2AgbWF0Y2hlcyBmcm9tIHRoZSBgdGV4dGAgb2YgYSBgc3VzcGVjdGAgZG9jdW1lbnQgKi9cbmV4cG9ydCBjb25zdCBzdXNwZWN0VGV4dE1pbm9yQ2hhbmdlcyA9IGV4dHJhY3RNYXRjaGVzKCdtaW5vckNoYW5nZXMnLCAndGV4dCcsICdzdXNwZWN0ZWQnKTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgaWRlbnRpY2FsYCBtYXRjaGVzIGZyb20gdGhlIGBodG1sYCBvZiBhIGBzdXNwZWN0YCBkb2N1bWVudCAqL1xuZXhwb3J0IGNvbnN0IHN1c3BlY3RIdG1sSWRlbnRpY2FsID0gZXh0cmFjdE1hdGNoZXMoJ2lkZW50aWNhbCcsICdodG1sJywgJ3N1c3BlY3RlZCcpO1xuXG4vKiogQSBmdW5jdGlvbiB0byBleHRyYWN0IGByZWxhdGVkTWVhbmluZ2AgbWF0Y2hlcyBmcm9tIHRoZSBgaHRtbGAgb2YgYSBgc3VzcGVjdGAgZG9jdW1lbnQgKi9cbmV4cG9ydCBjb25zdCBzdXNwZWN0SHRtbFJlbGF0ZWRNZWFuaW5nID0gZXh0cmFjdE1hdGNoZXMoJ3JlbGF0ZWRNZWFuaW5nJywgJ2h0bWwnLCAnc3VzcGVjdGVkJyk7XG5cbi8qKiBBIGZ1bmN0aW9uIHRvIGV4dHJhY3QgYG1pbm9yQ2hhbmdlc2AgbWF0Y2hlcyBmcm9tIHRoZSBgaHRtbGAgb2YgYSBgc3VzcGVjdGAgZG9jdW1lbnQgKi9cbmV4cG9ydCBjb25zdCBzdXNwZWN0SHRtbE1pbm9yQ2hhbmdlcyA9IGV4dHJhY3RNYXRjaGVzKCdtaW5vckNoYW5nZXMnLCAnaHRtbCcsICdzdXNwZWN0ZWQnKTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgZXhjbHVkZWRgIG1hdGNoZXMgZnJvbSB0aGUgYHRleHRgIG9mIGEgYHNvdXJjZWAgZG9jdW1lbnQgKi9cbmV4cG9ydCBjb25zdCBzb3VyY2VUZXh0RXhjbHVkZWQgPSBleHRyYWN0RXhjbHVkZWQoJ3RleHQnKTtcblxuLyoqIEEgZnVuY3Rpb24gdG8gZXh0cmFjdCBgZXhjbHVkZWRgIG1hdGNoZXMgZnJvbSB0aGUgYGh0bWxgIG9mIGEgYHNvdXJjZWAgZG9jdW1lbnQgKi9cbmV4cG9ydCBjb25zdCBzb3VyY2VIdG1sRXhjbHVkZWQgPSBleHRyYWN0RXhjbHVkZWQoJ2h0bWwnKTtcblxuLyoqXG4gKiBMb2NhdGUgdGhlIHJlc3BlY3RpdmUgbWF0Y2ggc3RhcnQgaW5kZXggZm9yIGEgZ2l2ZW4gaW5kZXggaW4gdGhlIGdpdmVuIGNvbXBhcmlzb24uXG4gKiBJZiBgZnJvbVNvdXJjZWAgaXMgc2V0IHRvIHRydWUsIHRoZSBpbml0aWFsIGluZGV4IGlzIGFzc3VtZWQgdG8gYmUgZnJvbSB0aGUgY29tcGFyaXNvbiBzb3VyY2VcbiAqIGFuZCB0aGVyZWZvcmUgd2lsbCBzZWFyY2ggaW4gdGhlIHJlc3BlY3RpdmUgYENvbXBhcmlzb25EYXRhYC4gUmV0dXJucyBhIHR1cGxlIG9mIHR3byBpbmRpY2VzXG4gKiB3aGVyZSB0aGUgZmlyc3QgbnVtYmVyIGlzIHN0YXJ0IGluZGV4IG9mIHRoZSByZXNwZWN0aXZlIG1hdGNoLCBhbmQgdGhlIHNlY29uZCBpcyB0aGUgc3RhcnQgaW5kZXhcbiAqIG9mIHRoZSBjbG9zZXN0IG1hdGNoIHRvIHRoZSBpbml0aWFsbHkgZ2l2ZW4gaW5kZXhcbiAqIEBwYXJhbSBpbmRleCBhIHBvc2l0aW9uIG9uIHRoZSB0ZXh0L2h0bWwgdGhhdCBjb3ZlcnMgYSBtYXRjaFxuICogQHBhcmFtIGNvbXBhcmlzb24gY29tcGFyaXNvbiByZWxldmFudCB0byB0aGUgbWF0Y2ggdHlwZSBhbmQgYXNzb2NpYXRlZCBjb250ZW50XG4gKiBAcGFyYW0gZnJvbVNvdXJjZSBmbGFnIGluZGljYXRpbmcgdGhhdCBgaW5kZXhgIGlzIGNvbWluZyBmcm9tIHRoZSBzb3VyY2Ugc3VzcGVjdFxuICovXG5leHBvcnQgY29uc3QgZmluZFJlc3BlY3RpdmVTdGFydCA9IChpbmRleDogbnVtYmVyLCBjb21wYXJpc29uOiBDb21wYXJpc29uLCBmcm9tU291cmNlID0gdHJ1ZSk6IFtudW1iZXIsIG51bWJlcl0gPT4ge1xuXHRjb25zdCB7IHNvdXJjZSwgc3VzcGVjdGVkIH0gPSBjb21wYXJpc29uO1xuXHRjb25zdCBbZnJvbSwgdG9dID0gZnJvbVNvdXJjZSA/IFtzb3VyY2UsIHN1c3BlY3RlZF0gOiBbc3VzcGVjdGVkLCBzb3VyY2VdO1xuXHRjb25zdCBmb3VuZCA9IGZyb20uY2hhcnMuc3RhcnRzLmZpbmRJbmRleCgocywgaSkgPT4gcyA8PSBpbmRleCAmJiBpbmRleCA8PSBzICsgc291cmNlLmNoYXJzLmxlbmd0aHNbaV0pO1xuXHRyZXR1cm4gW3RvLmNoYXJzLnN0YXJ0c1tmb3VuZF0sIGZyb20uY2hhcnMuc3RhcnRzW2ZvdW5kXV07XG59O1xuXG4vKipcbiAqIFRoaXMgZnVuY3Rpb24gd2lsbCBwcm9jZXNzIG9uZSBvciBtb3JlIHJlc3VsdHMgYW5kIGdlbmVyYXRlIGEgbGlzdCBvZiBtYXRjaCBpbnRlcnZhbHMgdGhhdCB3aWxsIGhlbHBcbiAqIGhpZ2hsaWdodCB0aGUgc291cmNlIGh0bWwgd2l0aCByZXNwZWN0IHRvIHVzZXIgc2V0dGluZ3MgYW5kIG1hdGNoIHR5cGUgcHJpb3JpdHlcbiAqIEBwYXJhbSByZXN1bHRzIG9uZSBvciBtb3JlIHJlc3VsdCBpdGVtIG9uIHdoaWNoIHRoZSBjYWxjdWxhdGlvbiB3aWxsIGJlIGJhc2VkIG9uXG4gKiBAcGFyYW0gc2V0dGluZ3MgdGhlIGN1cnJlbnQgdXNlciBzZXR0aW5nc1xuICogQHBhcmFtIHNvdXJjZSB0aGUgc2NhbiBzb3VyY2VcbiAqIEBwYXJhbSB0ZXh0IGB0cnVlYCBpZiBjYWxjdWxhdGlvbiBzaG91bGQgYmFzZSBvbiB0ZXh0IGNvbXBhcmlzb24sIGBmYWxzZWAgZm9yIGh0bWxcbiAqL1xuZXhwb3J0IGNvbnN0IHByb2Nlc3NTb3VyY2VUZXh0ID0gKFxuXHRyZXN1bHRzOiBSZXN1bHRJdGVtIHwgUmVzdWx0SXRlbVtdLFxuXHRzZXR0aW5nczogQ29weWxlYWtzUmVwb3J0T3B0aW9ucyxcblx0c291cmNlOiBTY2FuU291cmNlLFxuXHR0ZXh0OiBib29sZWFuID0gdHJ1ZVxuKSA9PiB7XG5cdC8vIGlmICghc291cmNlIHx8ICFzb3VyY2UudGV4dCkge1xuXHQvLyBcdHJldHVybiBudWxsO1xuXHQvLyB9XG5cdGNvbnN0IGl0ZW1zID0gW10uY29uY2F0KHJlc3VsdHMpO1xuXHRjb25zdCBpZGVudGljYWwgPSBzZXR0aW5ncy5zaG93SWRlbnRpY2FsXG5cdFx0PyBpdGVtcy5yZWR1Y2UoKGFjYywgcmVzKSA9PiBhY2MuY29uY2F0KCh0ZXh0ID8gc291cmNlVGV4dElkZW50aWNhbCA6IHNvdXJjZUh0bWxJZGVudGljYWwpKHJlcykpLCBbXSlcblx0XHQ6IFtdO1xuXHRjb25zdCBtaW5vciA9IHNldHRpbmdzLnNob3dNaW5vckNoYW5nZXNcblx0XHQ/IGl0ZW1zLnJlZHVjZSgoYWNjLCByZXMpID0+IGFjYy5jb25jYXQoKHRleHQgPyBzb3VyY2VUZXh0TWlub3JDaGFuZ2VzIDogc291cmNlSHRtbE1pbm9yQ2hhbmdlcykocmVzKSksIFtdKVxuXHRcdDogW107XG5cdGNvbnN0IHJlbGF0ZWQgPSBzZXR0aW5ncy5zaG93UmVsYXRlZFxuXHRcdD8gaXRlbXMucmVkdWNlKChhY2MsIHJlcykgPT4gYWNjLmNvbmNhdCgodGV4dCA/IHNvdXJjZVRleHRSZWxhdGVkTWVhbmluZyA6IHNvdXJjZUh0bWxSZWxhdGVkTWVhbmluZykocmVzKSksIFtdKVxuXHRcdDogW107XG5cdGNvbnN0IGV4Y2x1ZGVkID0gc291cmNlVGV4dEV4Y2x1ZGVkKHNvdXJjZSk7XG5cdGNvbnN0IGdyb3VwZWQgPSBtZXJnZU1hdGNoZXMoWy4uLmlkZW50aWNhbCwgLi4ubWlub3IsIC4uLnJlbGF0ZWQsIC4uLmV4Y2x1ZGVkXSk7XG5cdGNvbnN0IGZpbGxlZCA9IGZpbGxNaXNzaW5nR2Fwcyhncm91cGVkLCBzb3VyY2UudGV4dC52YWx1ZS5sZW5ndGgpO1xuXHRyZXR1cm4gcGFnaW5hdGVNYXRjaGVzKHNvdXJjZS50ZXh0LnZhbHVlLCBzb3VyY2UudGV4dC5wYWdlcy5zdGFydFBvc2l0aW9uLCBmaWxsZWQpO1xufTtcblxuLyoqXG4gKiBUaGlzIGZ1bmN0aW9uIHdpbGwgcHJvY2VzcyBub3RpZmljYXRpb25zIGFuZCBnZW5lcmF0ZSBhIGxpc3Qgb2YgbWF0Y2ggaW50ZXJ2YWxzIHRoYXQgd2lsbCBoZWxwXG4gKiBoaWdobGlnaHQgdGhlIHNvdXJjZSB0ZXh0LlxuICogQHBhcmFtIHNvdXJjZSB0aGUgc2NhbiBzb3VyY2VcbiAqIEBwYXJhbSBhbGVydFRvTWF0Y2ggYWxlcnQgdG8gcHJvY2Vzc1xuICovXG5leHBvcnQgY29uc3QgcHJvY2Vzc1N1c3BlY3RlZENoYXJhY3Rlck1hdGNoZXMgPSAoXG5cdHNvdXJjZTogU2NhblNvdXJjZSxcblx0YWxlcnRUb01hdGNoOiBDb21wbGV0ZVJlc3VsdE5vdGlmaWNhdGlvbkFsZXJ0XG4pOiBTbGljZWRNYXRjaFtdW10gPT4ge1xuXHRjb25zdCBtYXRjaGVzOiBNYXRjaFtdID0gW107XG5cdGNvbnN0IGRhdGE6IHtcblx0XHRzdGFydHM6IG51bWJlcltdO1xuXHRcdGxlbmd0aHM6IG51bWJlcltdO1xuXHR9ID0gSlNPTi5wYXJzZShhbGVydFRvTWF0Y2guYWRkaXRpb25hbERhdGEpO1xuXHRpZiAoZGF0YSAmJiBkYXRhLnN0YXJ0cyAmJiBkYXRhLmxlbmd0aHMpIHtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEuc3RhcnRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRtYXRjaGVzLnB1c2goe1xuXHRcdFx0XHRzdGFydDogZGF0YS5zdGFydHNbaV0sXG5cdFx0XHRcdGVuZDogZGF0YS5zdGFydHNbaV0gKyBkYXRhLmxlbmd0aHNbaV0sXG5cdFx0XHRcdHR5cGU6IE1hdGNoVHlwZS5zdXNwZWN0ZWRDaGFyYWN0ZXJSZXBsYWNlbWVudCxcblx0XHRcdFx0aWRzOiBbXSxcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdGNvbnN0IGdyb3VwZWQgPSBtYXRjaGVzO1xuXHRjb25zdCBmaWxsZWQgPSBmaWxsTWlzc2luZ0dhcHMoZ3JvdXBlZCwgc291cmNlLnRleHQudmFsdWUubGVuZ3RoKTtcblx0cmV0dXJuIHBhZ2luYXRlTWF0Y2hlcyhzb3VyY2UudGV4dC52YWx1ZSwgc291cmNlLnRleHQucGFnZXMuc3RhcnRQb3NpdGlvbiwgZmlsbGVkKTtcbn07XG5cbi8qKlxuICogVGhpcyBmdW5jdGlvbiB3aWxsIHByb2Nlc3Mgbm90aWZpY2F0aW9ucyBhbmQgZ2VuZXJhdGUgYSBsaXN0IG9mIG1hdGNoIGludGVydmFscyB0aGF0IHdpbGwgaGVscFxuICogaGlnaGxpZ2h0IHRoZSBzb3VyY2UgdGV4dC5cbiAqIEBwYXJhbSBzb3VyY2UgdGhlIHNjYW4gc291cmNlXG4gKiBAcGFyYW0gYWxlcnRUb01hdGNoIGFsZXJ0IHRvIHByb2Nlc3NcbiAqL1xuZXhwb3J0IGNvbnN0IHByb2Nlc3NBSUNoZWF0aW5nTWF0Y2hlcyA9IChcblx0c291cmNlOiBTY2FuU291cmNlLFxuXHRhbGVydFRvTWF0Y2g6IENvbXBsZXRlUmVzdWx0Tm90aWZpY2F0aW9uQWxlcnRcbik6IFNsaWNlZE1hdGNoW11bXSA9PiB7XG5cdGNvbnN0IG1hdGNoZXM6IE1hdGNoW10gPSBbXTtcblx0dmFyIHNjYW5SZXN1bHQgPSBKU09OLnBhcnNlKGFsZXJ0VG9NYXRjaC5hZGRpdGlvbmFsRGF0YSkgYXMgQUlTY2FuUmVzdWx0O1xuXHRzY2FuUmVzdWx0Py5yZXN1bHRzPy5mb3JFYWNoKHJlc3VsdCA9PiB7XG5cdFx0cmVzdWx0Py5tYXRjaGVzPy5mb3JFYWNoKChtYXRjaDogQUlTY2FuUmVzdWx0TWF0Y2gpID0+IHtcblx0XHRcdGNvbnN0IG1hcHBlZE1hdGNoZXMgPSBtYXRjaD8udGV4dC5jaGFycz8uc3RhcnRzPy5tYXAoXG5cdFx0XHRcdChzdGFydCwgaWR4KSA9PlxuXHRcdFx0XHRcdCh7XG5cdFx0XHRcdFx0XHRzdGFydCxcblx0XHRcdFx0XHRcdGVuZDogc3RhcnQgKyBtYXRjaC50ZXh0LmNoYXJzLmxlbmd0aHNbaWR4XSxcblx0XHRcdFx0XHRcdHR5cGU6IHJlc3VsdC5jbGFzc2lmaWNhdGlvbiA9PSBFTWF0Y2hDbGFzc2lmaWNhdGlvbi5BSSA/IE1hdGNoVHlwZS5haVRleHQgOiBNYXRjaFR5cGUubm9uZSxcblx0XHRcdFx0XHRcdGlkczogW10sXG5cdFx0XHRcdFx0XHRjbGFzc2lmaWNhdGlvbjogcmVzdWx0LmNsYXNzaWZpY2F0aW9uLFxuXHRcdFx0XHRcdFx0cHJvYmFiaWxpdHk6IHJlc3VsdC5wcm9iYWJpbGl0eSxcblx0XHRcdFx0XHRcdHRvdGFsV29yZHM6IG1hdGNoLnRleHQud29yZHMubGVuZ3Roc1tpZHhdLFxuXHRcdFx0XHRcdH0gYXMgQUlNYXRjaClcblx0XHRcdCk7XG5cdFx0XHRpZiAobWFwcGVkTWF0Y2hlcykgbWF0Y2hlcy5wdXNoKC4uLm1hcHBlZE1hdGNoZXMpO1xuXHRcdH0pO1xuXHR9KTtcblxuXHRjb25zdCBncm91cGVkID0gbWF0Y2hlcztcblx0Y29uc3QgZmlsbGVkID0gZmlsbE1pc3NpbmdHYXBzKGdyb3VwZWQsIHNvdXJjZS50ZXh0LnZhbHVlLmxlbmd0aCk7XG5cdHJldHVybiBwYWdpbmF0ZU1hdGNoZXMoc291cmNlLnRleHQudmFsdWUsIHNvdXJjZS50ZXh0LnBhZ2VzLnN0YXJ0UG9zaXRpb24sIGZpbGxlZCk7XG59O1xuXG4vKipcbiAqIFRoaXMgZnVuY3Rpb24gd2lsbCBwcm9jZXNzIG9uZSByZXN1bHQgYW5kIGdlbmVyYXRlIGEgbGlzdCBvZiBtYXRjaCBpbnRlcnZhbHMgdGhhdCB3aWxsIGhlbHBcbiAqIGhpZ2hsaWdodCB0aGUgc3VzcGVjdCB0ZXh0IHdpdGggcmVzcGVjdCB0byB1c2VyIG9wdGlvbnMgYW5kIG1hdGNoIHR5cGUgcHJpb3JpdHlcbiAqIEBwYXJhbSBzdXNwZWN0IHRoZSBzdXNwZWN0IHJlc3VsdCBpdGVtXG4gKiBAcGFyYW0gb3B0aW9ucyB0aGUgY3VycmVudCB1c2VyIG9wdGlvbnNcbiAqIEBwYXJhbSB0ZXh0IGB0cnVlYCBpZiBjYWxjdWxhdGlvbiBzaG91bGQgYmFzZSBvbiB0ZXh0IGNvbXBhcmlzb24sIGBmYWxzZWAgZm9yIGh0bWxcbiAqL1xuZXhwb3J0IGNvbnN0IHByb2Nlc3NTdXNwZWN0VGV4dCA9IChcblx0c3VzcGVjdDogUmVzdWx0SXRlbSxcblx0b3B0aW9uczogQ29weWxlYWtzUmVwb3J0T3B0aW9ucyxcblx0dGV4dDogYm9vbGVhbiA9IHRydWVcbik6IFNsaWNlZE1hdGNoW11bXSA9PiB7XG5cdGNvbnN0IGlkZW50aWNhbCA9IG9wdGlvbnMuc2hvd0lkZW50aWNhbCA/ICh0ZXh0ID8gc3VzcGVjdFRleHRJZGVudGljYWwgOiBzdXNwZWN0SHRtbElkZW50aWNhbCkoc3VzcGVjdCkgOiBbXTtcblx0Y29uc3QgbWlub3IgPSBvcHRpb25zLnNob3dNaW5vckNoYW5nZXMgPyAodGV4dCA/IHN1c3BlY3RUZXh0TWlub3JDaGFuZ2VzIDogc3VzcGVjdEh0bWxNaW5vckNoYW5nZXMpKHN1c3BlY3QpIDogW107XG5cdGNvbnN0IHJlbGF0ZWQgPSBvcHRpb25zLnNob3dSZWxhdGVkID8gKHRleHQgPyBzdXNwZWN0VGV4dFJlbGF0ZWRNZWFuaW5nIDogc3VzcGVjdEh0bWxSZWxhdGVkTWVhbmluZykoc3VzcGVjdCkgOiBbXTtcblx0Y29uc3QgZ3JvdXBlZCA9IG1lcmdlTWF0Y2hlcyhbLi4uaWRlbnRpY2FsLCAuLi5taW5vciwgLi4ucmVsYXRlZF0pO1xuXHRjb25zdCBmaWxsZWQgPSBmaWxsTWlzc2luZ0dhcHMoZ3JvdXBlZCwgc3VzcGVjdC5yZXN1bHQudGV4dC52YWx1ZS5sZW5ndGgpO1xuXHRjb25zdCBmaW5hbCA9IHBhZ2luYXRlTWF0Y2hlcyhzdXNwZWN0LnJlc3VsdC50ZXh0LnZhbHVlLCBzdXNwZWN0LnJlc3VsdC50ZXh0LnBhZ2VzLnN0YXJ0UG9zaXRpb24sIGZpbGxlZCk7XG5cdHJldHVybiBmaW5hbDtcbn07XG5cbi8qKlxuICogVGhpcyBmdW5jdGlvbiB3aWxsIHByb2Nlc3Mgb25lIG9yIG1vcmUgcmVzdWx0cyBhbmQgZ2VuZXJhdGUgYSBsaXN0IG9mIG1hdGNoIGludGVydmFscyB0aGF0IHdpbGwgaGVscFxuICogaGlnaGxpZ2h0IHRoZSBzb3VyY2UgaHRtbCB3aXRoIHJlc3BlY3QgdG8gdXNlciBvcHRpb25zIGFuZCBtYXRjaCB0eXBlIHByaW9yaXR5XG4gKiBAcGFyYW0gcmVzdWx0cyBvbmUgb3IgbW9yZSByZXN1bHQgaXRlbSBvbiB3aGljaCB0aGUgY2FsY3VsYXRpb24gd2lsbCBiZSBiYXNlZCBvblxuICogQHBhcmFtIG9wdGlvbnMgdGhlIGN1cnJlbnQgdXNlciBvcHRpb25zXG4gKiBAcGFyYW0gc291cmNlIHRoZSBzY2FuIHNvdXJjZVxuICovXG5leHBvcnQgY29uc3QgcHJvY2Vzc1NvdXJjZUh0bWwgPSAoXG5cdHJlc3VsdHM6IFJlc3VsdEl0ZW0gfCBSZXN1bHRJdGVtW10sXG5cdG9wdGlvbnM6IENvcHlsZWFrc1JlcG9ydE9wdGlvbnMsXG5cdHNvdXJjZTogU2NhblNvdXJjZVxuKSA9PiB7XG5cdGlmICghc291cmNlIHx8ICFzb3VyY2UuaHRtbCkge1xuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cdGNvbnN0IGl0ZW1zID0gW10uY29uY2F0KHJlc3VsdHMpO1xuXHRjb25zdCBpZGVudGljYWwgPSBvcHRpb25zLnNob3dJZGVudGljYWwgPyBpdGVtcy5yZWR1Y2UoKGFjYywgcmVzKSA9PiBhY2MuY29uY2F0KHNvdXJjZUh0bWxJZGVudGljYWwocmVzKSksIFtdKSA6IFtdO1xuXHRjb25zdCBtaW5vciA9IG9wdGlvbnMuc2hvd01pbm9yQ2hhbmdlcyA/IGl0ZW1zLnJlZHVjZSgoYWNjLCByZXMpID0+IGFjYy5jb25jYXQoc291cmNlSHRtbE1pbm9yQ2hhbmdlcyhyZXMpKSwgW10pIDogW107XG5cdGNvbnN0IHJlbGF0ZWQgPSBvcHRpb25zLnNob3dSZWxhdGVkID8gaXRlbXMucmVkdWNlKChhY2MsIHJlcykgPT4gYWNjLmNvbmNhdChzb3VyY2VIdG1sUmVsYXRlZE1lYW5pbmcocmVzKSksIFtdKSA6IFtdO1xuXHRjb25zdCBleGNsdWRlZCA9IHNvdXJjZUh0bWxFeGNsdWRlZChzb3VyY2UpO1xuXHRjb25zdCBncm91cGVkID0gbWVyZ2VNYXRjaGVzKFsuLi5pZGVudGljYWwsIC4uLm1pbm9yLCAuLi5yZWxhdGVkLCAuLi5leGNsdWRlZF0pO1xuXHRjb25zdCBmaW5hbCA9IGZpbGxNaXNzaW5nR2Fwcyhncm91cGVkLCBzb3VyY2UuaHRtbC52YWx1ZS5sZW5ndGgpO1xuXHRyZXR1cm4gZmluYWw7XG59O1xuXG4vKipcbiAqIFRoaXMgZnVuY3Rpb24gd2lsbCBwcm9jZXNzIG9uZSByZXN1bHQgYW5kIGdlbmVyYXRlIGEgbGlzdCBvZiBtYXRjaCBpbnRlcnZhbHMgdGhhdFxuICogd2lsbCBoZWxwIGhpZ2hsaWdodCB0aGUgc3VzcGVjdCBodG1sIHdpdGggcmVzcGVjdCB0byB1c2VyIG9wdGlvbnMgYW5kIG1hdGNoIHR5cGUgcHJpb3JpdHlcbiAqIEBwYXJhbSBzdXNwZWN0IHRoZSBzdXNwZWN0IHJlc3VsdCBpdGVtXG4gKiBAcGFyYW0gb3B0aW9ucyB0aGUgY3VycmVudCB1c2VyIG9wdGlvbnNcbiAqL1xuZXhwb3J0IGNvbnN0IHByb2Nlc3NTdXNwZWN0SHRtbCA9IChzdXNwZWN0OiBSZXN1bHRJdGVtLCBvcHRpb25zOiBDb3B5bGVha3NSZXBvcnRPcHRpb25zKTogTWF0Y2hbXSA9PiB7XG5cdGlmICghc3VzcGVjdCB8fCAhc3VzcGVjdC5yZXN1bHQuaHRtbCkge1xuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cdGNvbnN0IGlkZW50aWNhbCA9IG9wdGlvbnMuc2hvd0lkZW50aWNhbCA/IHN1c3BlY3RIdG1sSWRlbnRpY2FsKHN1c3BlY3QpIDogW107XG5cdGNvbnN0IG1pbm9yID0gb3B0aW9ucy5zaG93TWlub3JDaGFuZ2VzID8gc3VzcGVjdEh0bWxNaW5vckNoYW5nZXMoc3VzcGVjdCkgOiBbXTtcblx0Y29uc3QgcmVsYXRlZCA9IG9wdGlvbnMuc2hvd1JlbGF0ZWQgPyBzdXNwZWN0SHRtbFJlbGF0ZWRNZWFuaW5nKHN1c3BlY3QpIDogW107XG5cdGNvbnN0IGdyb3VwZWQgPSBtZXJnZU1hdGNoZXMoWy4uLmlkZW50aWNhbCwgLi4ubWlub3IsIC4uLnJlbGF0ZWRdKTtcblx0cmV0dXJuIGZpbGxNaXNzaW5nR2Fwcyhncm91cGVkLCBzdXNwZWN0LnJlc3VsdC5odG1sLnZhbHVlLmxlbmd0aCk7XG59O1xuIl19